#include "common-mt7621/rutm.dtsi"
#include "common-mt7621/shiftreg.dtsi"
#include "common-mt7621/tpm.dtsi"
#include "common-mt7621/input-output.dtsi"

// PWR, RST  |G0|G10|
// IN, OUT   |G8|G12|
// SR CTRL   |G5|G9|G11|
// WAN	     |S25-S28|
// WIFI	  	 |G13|S17|
// ETH       |S0-S7|G15|G16|
// 5G		 |G7|S16-S23|
// 4G		 |G6|S8-S15|S29|
// TPM       |G14|
/ {
	model = "Teltonika RUTM56";

	ext_io {
		shift_io: shift_io@0 {
			registers-number = <4>;
			/delete-property/ enable-gpios;
		};
	};

	gpio-export {
		compatible = "gpio-export";
		#size-cells = <0>;

		gpio_modem_reset_1 {
			gpio-export,name = "modem_reset";
			gpio-export,output = <0>;
			gpios = <&shift_io 19 GPIO_ACTIVE_HIGH>;
		};

		gpio_modem_power_1 {
			gpio-export,name = "modem_power";
			gpio-export,output = <1>; // tmp
			gpios = <&shift_io 20 GPIO_ACTIVE_HIGH>;
		};

		gpio_modem_status_1 {
			gpio-export,name = "modem_status";
			gpio-export,input = <0>;
			gpios = <&gpio 7 GPIO_ACTIVE_LOW>;
		};

		gpio_modem_reset_2 {
			gpio-export,name = "modem2_reset";
			gpio-export,output = <0>;
			gpios = <&shift_io 11 GPIO_ACTIVE_HIGH>;
		};

		gpio_modem_power_2 {
			gpio-export,name = "modem2_power";
			gpio-export,output = <1>; // tmp
			gpios = <&shift_io 12 GPIO_ACTIVE_HIGH>;
		};

		gpio_modem_status_2 {
			gpio-export,name = "modem2_status";
			gpio-export,input = <0>;
			gpios = <&gpio 6 GPIO_ACTIVE_LOW>;
		};

		gpio_sim_select_2 {
			gpio-export,name = "sim_sel2";
			gpio-export,output = <0>;
			gpios = <&shift_io 29 GPIO_ACTIVE_HIGH>;
		};

		gpio_tpm_reset {
			gpio-export,name = "tpm_reset";
			gpio-export,output = <1>;
			gpios = <&gpio 14 GPIO_ACTIVE_HIGH>; // active low, but doesn't work with gpio-export,output = <0> correctly on startup
		};
	};

	leds {
		led_gen_3 {
			label = "mob_gen_3";
			gpios = <&shift_io 23 GPIO_ACTIVE_HIGH>;
		};

		led_gen_4 {
			label = "mob_gen_4";
			gpios = <&shift_io 22 GPIO_ACTIVE_HIGH>;
		};

		led_gen_5 {
			label = "mob_gen_5";
			gpios = <&shift_io 21 GPIO_ACTIVE_HIGH>;
		};

		led_gen2_2 {
			label = "mob2_gen_2";
			gpios = <&shift_io 15 GPIO_ACTIVE_HIGH>;
		};

		led_gen2_3 {
			label = "mob2_gen_3";
			gpios = <&shift_io 14 GPIO_ACTIVE_HIGH>;
		};

		led_gen2_4 {
			label = "mob2_gen_4";
			gpios = <&shift_io 13 GPIO_ACTIVE_HIGH>;
		};

		led_wifi_24 {
			label = "wifi_gen_2";
			gpios = <&gpio 13 GPIO_ACTIVE_HIGH>;
		};

		led_wifi_50 {
			label = "wifi_gen_5";
			gpios = <&gpio 17 GPIO_ACTIVE_HIGH>;
		};

		led_wan_sim1 {
			label = "wan_sim_1";
			gpios = <&shift_io 25 GPIO_ACTIVE_HIGH>;
		};

		led_wan_sim2 {
			label = "wan_sim_2";
			gpios = <&shift_io 26 GPIO_ACTIVE_HIGH>;
		};

		led_wan_eth {
			label = "wan_eth_3";
			gpios = <&shift_io 28 GPIO_ACTIVE_HIGH>;
		};

		led_wan_wifi {
			label = "wan_wifi_4";
			gpios = <&shift_io 27 GPIO_ACTIVE_HIGH>;
		};

		led_ssid_1 {
			label = "mob_ssid_1";
			gpios = <&shift_io 18 GPIO_ACTIVE_HIGH>;
			linux,default-trigger = "timer";
		};

		led_ssid_3 {
			label = "mob_ssid_3";
			gpios = <&shift_io 17 GPIO_ACTIVE_HIGH>;
			linux,default-trigger = "timer";
		};

		led_ssid_5 {
			label = "mob_ssid_5";
			gpios = <&shift_io 16 GPIO_ACTIVE_HIGH>;
			linux,default-trigger = "timer";
		};

		led_ssid2_1 {
			label = "mob2_ssid_1";
			gpios = <&shift_io 10 GPIO_ACTIVE_HIGH>;
			linux,default-trigger = "timer";
		};

		led_ssid2_3 {
			label = "mob2_ssid_3";
			gpios = <&shift_io 9 GPIO_ACTIVE_HIGH>;
			linux,default-trigger = "timer";
		};

		led_ssid2_5 {
			label = "mob2_ssid_5";
			gpios = <&shift_io 8 GPIO_ACTIVE_HIGH>;
			linux,default-trigger = "timer";
		};

		led_eth_y5 {
			label = "eth_y5";
			gpios = <&gpio 15 GPIO_ACTIVE_HIGH>;
		};

		led_eth_y4 {
			label = "eth_y4";
			gpios = <&shift_io 4 GPIO_ACTIVE_LOW>;
		};

		led_eth_y3 {
			label = "eth_y3";
			gpios = <&shift_io 7 GPIO_ACTIVE_HIGH>;
		};

		led_eth_y2 {
			label = "eth_y2";
			gpios = <&shift_io 6 GPIO_ACTIVE_HIGH>;
		};

		led_eth_y1 {
			label = "eth_y1";
			gpios = <&shift_io 5 GPIO_ACTIVE_HIGH>;
		};

		led_eth_g5 {
			label = "eth_g5";
			gpios = <&gpio 16 GPIO_ACTIVE_HIGH>;
		};

		led_eth_g4 {
			label = "eth_g4";
			gpios = <&shift_io 3 GPIO_ACTIVE_LOW>;
		};

		led_eth_g3 {
			label = "eth_g3";
			gpios = <&shift_io 2 GPIO_ACTIVE_HIGH>;
		};

		led_eth_g2 {
			label = "eth_g2";
			gpios = <&shift_io 1 GPIO_ACTIVE_HIGH>;
		};

		led_eth_g1 {
			label = "eth_g1";
			gpios = <&shift_io 0 GPIO_ACTIVE_HIGH>;
		};
	};

	tlt_gpios {
		gpiochip_info {
			hw_0 {
				gpiochip_3 = <32>;
			};
		};

		misc {
			GPIO_125 {
				line_name = "GPIO_SIM_SELECT_2";
			};
			GPIO_115 {
				line_name = "GPIO_MODEM_RESET_1";
			};
			GPIO_116 {
				line_name = "GPIO_MODEM_POWER_1";
			};
			GPIO_7 {
				line_name = "GPIO_MODEM_STATUS_1";
				active_low;
			};
			GPIO_107 {
				line_name = "GPIO_MODEM_RESET_2";
			};
			GPIO_108 {
				line_name = "GPIO_MODEM_POWER_2";
			};
			GPIO_6 {
				line_name = "GPIO_MODEM_STATUS_2";
				active_low;
			};
			GPIO_14 {
				line_name = "GPIO_TPM_RESET";
			};
		};
	};

	reg_soc_3v3: reg-soc-3v3 {
		compatible = "regulator-fixed";
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
		regulator-name = "soc_3v3";
	};
};

&switch0 {
	ports {
		port@0 {
			status = "okay";
			label = "lan1";
		};

		port@1 {
			status = "okay";
			label = "lan2";
		};

		port@2 {
			status = "okay";
			label = "lan3";
		};

		port@3 {
			status = "okay";
			label = "lan4";
		};
	};
};

&xhci {
	modem_usbhub_3: hub@1 {
		compatible = "usb5e3,620";
		reg = <1>;
		reset-gpios = <&gpio 19 GPIO_ACTIVE_LOW>;
		vdd-supply = <&reg_soc_3v3>;
		peer-hub = <&modem_usbhub_2>;
	};

	modem_usbhub_2: hub@2 {
		compatible = "usb5e3,610";
		reg = <2>;
		reset-gpios = <&gpio 19 GPIO_ACTIVE_LOW>;
		vdd-supply = <&reg_soc_3v3>;
		peer-hub = <&modem_usbhub_3>;
	};
};

&mnfinfo {
	simpin3 {
		default = "";
		sec;
	};

	simpin4 {
		default = "";
		sec;
	};

	sim_cfg {
		default = "1111020_1122020_2210120_2220220";
	};
};
