(function($,E){typeof exports=="object"&&typeof module<"u"?module.exports=E():typeof define=="function"&&define.amd?define(E):($=typeof globalThis<"u"?globalThis:$||self,$["services/DynamicDNS_js"]=E())})(this,function(){"use strict";function $(e,t,i,r,n,o,a,u){var s=typeof e=="function"?e.options:e;t&&(s.render=t,s.staticRenderFns=i,s._compiled=!0),r&&(s.functional=!0),o&&(s._scopeId="data-v-"+o);var d;if(a?(d=function(f){f=f||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!f&&typeof __VUE_SSR_CONTEXT__<"u"&&(f=__VUE_SSR_CONTEXT__),n&&n.call(this,f),f&&f._registeredComponents&&f._registeredComponents.add(a)},s._ssrRegister=d):n&&(d=u?function(){n.call(this,(s.functional?this.parent:this).$root.$options.shadowRoot)}:n),d)if(s.functional){s._injectStyles=d;var c=s.render;s.render=function(h,S){return d.call(S),c(h,S)}}else{var l=s.beforeCreate;s.beforeCreate=l?[].concat(l,d):[d]}return{exports:e,options:s}}const E={inject:["formOptions"],props:{section:{type:Object,required:!0}},data(){return{authenticationType:[["emailAPI",this.$t("Email / API token")],["bearer",this.$t("Bearer token")]],ipv4Sources:[["network",this.$t("Custom")],["web",this.$t("Public")],["interface",this.$t("Private")],["script",this.$t("Script")]],formData:{service:[]},inputForceProps:{prop:"dyndns_force_interval_input",placeholder:"10",initial:"10",rules:this.checkTime,required:!0},selectCheckProps:{prop:"dyndns_check_interval_select",options:[["seconds",this.$t("Seconds")],["minutes",this.$t("Minutes")],["hours",this.$t("Hours")]],initial:"minutes"},selectForceProps:{prop:"dyndns_force_interval_select",options:[["minutes",this.$t("Minutes")],["hours",this.$t("Hours")],["days",this.$t("Days")]],initial:"hours"},checkRules:{seconds:"range(300,600000)",minutes:"range(5,600000)",hours:"range(1,600000)",default:"range(0,600000)"},forceRules:{minutes:"range(5,600000)",hours:"range(1,600000)",days:"range(1,600000)",default:"range(0,600000)"}}},computed:{nsupdateExists(){return this.$store.state.packages.includes("/usr/lib/opkg/info/ddns-scripts_nsupdate.control")},hasSSL(){return this.formOptions().hasSsl},serviceProviders(){return[["",`-- ${this.$t("Custom")} --`],...Object.keys(this.formOptions().providerData)]},interfaces(){return this.formOptions().interfaceData.filter(e=>e.id!=="loopback").map(this.$network.getName)},passwordLabel(){return this.section.cloudflare_authentication_type==="emailAPI"&&this.section.service_name==="cloudflare.com-v4"?this.$t("API token"):this.section.cloudflare_authentication_type==="bearer"&&this.section.service_name==="cloudflare.com-v4"?this.$t("Bearer token"):this.$t("Password")},inputCheckProps(){const e={prop:"dyndns_check_interval_input",placeholder:"10",initial:"10",rules:["uinteger","range(5,600000)"],required:!0};if(!this.section.check_interval)return e;const t=this.section.check_interval.split(",")[1];return e.rules[1]=this.getRule(t,this.checkRules),e},forceRule(){const e=this.section.force_interval.split(",")[1];return this.getRule(e,this.forceRules)}},methods:{validateField(e,t){const i=e.uciSection.id;e.vuciSection.forms[i][t].validate()},checkTime(e){this.$VuciValidator.value=e;const t=this.$VuciValidator.uinteger();if(!t.isValid)return t;const[{validator:i},r]=this.$VuciValidator.compile(this.forceRule),n=i(e,r);if(!n.isValid)return n;const[o,a]=this.section.check_interval.split(","),[u,s]=this.section.force_interval.split(","),d=this.calculateSeconds(o,a);return this.calculateSeconds(u,s)<d?{isValid:!1,message:this.$t("Force interval value should be higher than check interval")}:{isValid:!0}},calculateSeconds(e,t){const i={days:r=>parseInt(r)*86400,hours:r=>parseInt(r)*3600,minutes:r=>parseInt(r)*60,seconds:r=>parseInt(r)};return i[t]?i[t](e):null},getRule(e,t){return t[e]||t.default},validateCustomUpdateUrl(e){return/^[a-zA-Z0-9!@#$%&*+\-/=?^_`{|}~:.[\]]+$/.test(e)?{isValid:!0}:{isValid:!1,message:this.$t("Following characters are accepted: %s").format("a-zA-Z0-9!@#$%&*+-/=?^_`{|}~:.[]")}}}};var L=function(){var t=this,i=t._self._c;return i("vuci-form",{attrs:{config:"ddns",editing:""},scopedSlots:t._u([{key:"default",fn:function({uciData:r,editableSection:n}){return[i("vuci-named-section",{attrs:{"uci-data":r,name:n.id,title:`${t.$t("Dynamic DNS details for:")} ${n.id}`,endpoints:[{endpoint:"ddns/config"}],"data-key":"service"},scopedSlots:t._u([{key:"default",fn:function({s:o}){return[i("vuci-form-item-switch",{attrs:{"uci-section":o,name:"enabled",label:t.$t("Enabled"),help:t.$t("Turns the DDNS instance on or off.")}}),i("vuci-form-item-switch",{attrs:{"uci-section":o,name:"use_https",label:t.$t("Use HTTP secure"),help:t.$t("Configure Root CA certificates in %s System -> Administration -> Certificates %s").format("<a href='/system/admin/certificates/generation'>","</a>"),depend:t.hasSSL,rawhtml:""}}),i("vuci-form-item-input",{attrs:{"uci-section":o,name:"lookup_host",label:t.$t("Lookup hostname"),help:t.$t("Fully qualified domain name (FQDN) of your defined host.      This is required to verify what the hostname's current IP address at DNS is (using nslookup/host command)."),placeholder:"myhost.example.com",rules:"hostname",depend:t.nsupdateExists,required:""}}),i("vuci-form-item-select",{attrs:{"uci-section":o,name:"service_name",label:t.$t("DDNS service provider"),help:t.$t("Third party DNS service provider."),options:t.serviceProviders}}),i("vuci-form-item-input",{attrs:{"uci-section":o,name:"update_url",label:t.$t("Custom update-URL"),help:t.$t("Update URL to be used for updating your DDNS Provider. %s Follow instructions you will find on their WEB page.").format("<br>"),placeholder:"myhost.example.com",depend:!o.service_name,rules:t.validateCustomUpdateUrl,required:"",rawhtml:""}}),i("vuci-form-item-input",{attrs:{"uci-section":o,name:"domain",label:t.$t("Domain"),help:t.$t("Hostname that will be linked with the router's IP address."),placeholder:"myhost.example.com",rules:t.validateCustomUpdateUrl}}),i("vuci-form-item-select",{attrs:{"uci-section":o,name:"cloudflare_authentication_type",label:t.$t("Authentication type"),options:t.authenticationType,depend:o.service_name==="cloudflare.com-v4"}}),i("vuci-form-item-input",{attrs:{"uci-section":o,name:"username",label:o.service_name==="cloudflare.com-v4"?t.$t("Email"):t.$t("Username"),help:t.$t("Username required to login to the third party DNS service;      used to periodically login to your DNS service account and make necessary updates."),rules:[o.service_name==="cloudflare.com-v4"?"email":"credentials_validate"],maxlength:"64",placeholder:o.service_name==="cloudflare.com-v4"?"mail@domain.com":"",depend:o.cloudflare_authentication_type!=="bearer"}}),i("vuci-form-item-input",{attrs:{"uci-section":o,name:"password",label:t.passwordLabel,help:t.$t("Password required to login to the third party DNS service;      used to periodically login to your DNS service account and make necessary updates.      all characters are allowed except ` and space"),password:"",maxlength:"64",rules:"credentials_validate"}}),i("vuci-form-item-select",{attrs:{"uci-section":o,name:"ip_source",label:t.$t("IP address source"),help:t.$t("Defines the source to read the system's IPv4 Address from,      which will be sent to the DNS provider.      For example, if your router has a       Private IP (i.e., 10.140.56.57) on its WAN interface,      then you can send this exact IP to DDNS server by selecting Private."),initial:"network",options:t.ipv4Sources}}),i("vuci-form-item-select",{attrs:{"uci-section":o,name:"interface",label:t.$t("Event network"),help:t.$t("Network on which the DDNS updater scripts will be started."),initial:"wan",options:t.interfaces,depend:o.ip_source==="script"}}),i("vuci-form-item-select",{attrs:{"uci-section":o,name:"interface",label:t.$t("Network"),help:t.$t("Specifies which interface's IP address should be bound to the hostname."),initial:"wan",options:t.interfaces,depend:o.ip_source==="network"}}),i("vuci-form-item-input",{attrs:{"uci-section":o,name:"ip_url",label:t.$t("URL to detect"),help:t.$t("Defines the Web page to read the system's IPv4 address from."),initial:"http://checkip.dyndns.com",rules:"protourl",required:"",depend:o.ip_source==="web"}}),i("vuci-form-item-input",{attrs:{"uci-section":o,name:"ip_script",label:t.$t("Script"),help:t.$t("User defined script that will read the system's IPv4 address."),placeholder:"/path/to/script.sh",rules:"string",maxlength:"64",depend:o.ip_source==="script"}}),i("vuci-form-item-custom",{attrs:{name:"check_interval",inputs:"input,select","input-props":[t.inputCheckProps,t.selectCheckProps],"uci-section":o,label:t.$t("Check interval"),help:t.$t("Frequency at which the device will check whether it's IP address has changed.")},on:{change:a=>t.validateField(a,"force_interval")}}),i("vuci-form-item-custom",{attrs:{name:"force_interval",inputs:"input,select","input-props":[t.inputForceProps,t.selectForceProps],"uci-section":o,label:t.$t("Force interval"),help:t.$t("Frequency at which IP update requests are sent to the DNS provider.")},on:{change:a=>t.validateField(a,"check_interval")}})]}}],null,!0)})]}}]),model:{value:t.formData,callback:function(r){t.formData=r},expression:"formData"}})},q=[],H=$(E,L,q,!1,null,null,null,null);const z=H.exports;/*!
 * vuex v3.6.2
 * (c) 2021 Evan You
 * @license MIT
 */function B(e){var t=Number(e.version.split(".")[0]);if(t>=2)e.mixin({beforeCreate:r});else{var i=e.prototype._init;e.prototype._init=function(n){n===void 0&&(n={}),n.init=n.init?[r].concat(n.init):r,i.call(this,n)}}function r(){var n=this.$options;n.store?this.$store=typeof n.store=="function"?n.store():n.store:n.parent&&n.parent.$store&&(this.$store=n.parent.$store)}}var W=typeof window<"u"?window:typeof global<"u"?global:{},w=W.__VUE_DEVTOOLS_GLOBAL_HOOK__;function X(e){w&&(e._devtoolHook=w,w.emit("vuex:init",e),w.on("vuex:travel-to-state",function(t){e.replaceState(t)}),e.subscribe(function(t,i){w.emit("vuex:mutation",t,i)},{prepend:!0}),e.subscribeAction(function(t,i){w.emit("vuex:action",t,i)},{prepend:!0}))}function g(e,t){Object.keys(e).forEach(function(i){return t(e[i],i)})}function V(e){return e!==null&&typeof e=="object"}function Z(e){return e&&typeof e.then=="function"}function m(e,t){if(!e)throw new Error("[vuex] "+t)}function J(e,t){return function(){return e(t)}}var _=function(t,i){this.runtime=i,this._children=Object.create(null),this._rawModule=t;var r=t.state;this.state=(typeof r=="function"?r():r)||{}},A={namespaced:{configurable:!0}};A.namespaced.get=function(){return!!this._rawModule.namespaced},_.prototype.addChild=function(t,i){this._children[t]=i},_.prototype.removeChild=function(t){delete this._children[t]},_.prototype.getChild=function(t){return this._children[t]},_.prototype.hasChild=function(t){return t in this._children},_.prototype.update=function(t){this._rawModule.namespaced=t.namespaced,t.actions&&(this._rawModule.actions=t.actions),t.mutations&&(this._rawModule.mutations=t.mutations),t.getters&&(this._rawModule.getters=t.getters)},_.prototype.forEachChild=function(t){g(this._children,t)},_.prototype.forEachGetter=function(t){this._rawModule.getters&&g(this._rawModule.getters,t)},_.prototype.forEachAction=function(t){this._rawModule.actions&&g(this._rawModule.actions,t)},_.prototype.forEachMutation=function(t){this._rawModule.mutations&&g(this._rawModule.mutations,t)},Object.defineProperties(_.prototype,A);var b=function(t){this.register([],t,!1)};b.prototype.get=function(t){return t.reduce(function(i,r){return i.getChild(r)},this.root)},b.prototype.getNamespace=function(t){var i=this.root;return t.reduce(function(r,n){return i=i.getChild(n),r+(i.namespaced?n+"/":"")},"")},b.prototype.update=function(t){T([],this.root,t)},b.prototype.register=function(t,i,r){var n=this;r===void 0&&(r=!0),process.env.NODE_ENV!=="production"&&M(t,i);var o=new _(i,r);if(t.length===0)this.root=o;else{var a=this.get(t.slice(0,-1));a.addChild(t[t.length-1],o)}i.modules&&g(i.modules,function(u,s){n.register(t.concat(s),u,r)})},b.prototype.unregister=function(t){var i=this.get(t.slice(0,-1)),r=t[t.length-1],n=i.getChild(r);if(!n){process.env.NODE_ENV!=="production"&&console.warn("[vuex] trying to unregister module '"+r+"', which is not registered");return}n.runtime&&i.removeChild(r)},b.prototype.isRegistered=function(t){var i=this.get(t.slice(0,-1)),r=t[t.length-1];return i?i.hasChild(r):!1};function T(e,t,i){if(process.env.NODE_ENV!=="production"&&M(e,i),t.update(i),i.modules)for(var r in i.modules){if(!t.getChild(r)){process.env.NODE_ENV!=="production"&&console.warn("[vuex] trying to add a new module '"+r+"' on hot reloading, manual reload is needed");return}T(e.concat(r),t.getChild(r),i.modules[r])}}var P={assert:function(e){return typeof e=="function"},expected:"function"},K={assert:function(e){return typeof e=="function"||typeof e=="object"&&typeof e.handler=="function"},expected:'function or object with "handler" function'},j={getters:P,mutations:P,actions:K};function M(e,t){Object.keys(j).forEach(function(i){if(t[i]){var r=j[i];g(t[i],function(n,o){m(r.assert(n),Q(e,i,o,n,r.expected))})}})}function Q(e,t,i,r,n){var o=t+" should be "+n+' but "'+t+"."+i+'"';return e.length>0&&(o+=' in module "'+e.join(".")+'"'),o+=" is "+JSON.stringify(r)+".",o}var p,v=function e(t){var i=this;t===void 0&&(t={}),!p&&typeof window<"u"&&window.Vue&&ot(window.Vue),process.env.NODE_ENV!=="production"&&(m(p,"must call Vue.use(Vuex) before creating a store instance."),m(typeof Promise<"u","vuex requires a Promise polyfill in this browser."),m(this instanceof e,"store must be called with the new operator."));var r=t.plugins;r===void 0&&(r=[]);var n=t.strict;n===void 0&&(n=!1),this._committing=!1,this._actions=Object.create(null),this._actionSubscribers=[],this._mutations=Object.create(null),this._wrappedGetters=Object.create(null),this._modules=new b(t),this._modulesNamespaceMap=Object.create(null),this._subscribers=[],this._watcherVM=new p,this._makeLocalGettersCache=Object.create(null);var o=this,a=this,u=a.dispatch,s=a.commit;this.dispatch=function(f,h){return u.call(o,f,h)},this.commit=function(f,h,S){return s.call(o,f,h,S)},this.strict=n;var d=this._modules.root.state;N(this,d,[],this._modules.root),O(this,d),r.forEach(function(l){return l(i)});var c=t.devtools!==void 0?t.devtools:p.config.devtools;c&&X(this)},k={state:{configurable:!0}};k.state.get=function(){return this._vm._data.$$state},k.state.set=function(e){process.env.NODE_ENV!=="production"&&m(!1,"use store.replaceState() to explicit replace store state.")},v.prototype.commit=function(t,i,r){var n=this,o=D(t,i,r),a=o.type,u=o.payload,s=o.options,d={type:a,payload:u},c=this._mutations[a];if(!c){process.env.NODE_ENV!=="production"&&console.error("[vuex] unknown mutation type: "+a);return}this._withCommit(function(){c.forEach(function(f){f(u)})}),this._subscribers.slice().forEach(function(l){return l(d,n.state)}),process.env.NODE_ENV!=="production"&&s&&s.silent&&console.warn("[vuex] mutation type: "+a+". Silent option has been removed. Use the filter functionality in the vue-devtools")},v.prototype.dispatch=function(t,i){var r=this,n=D(t,i),o=n.type,a=n.payload,u={type:o,payload:a},s=this._actions[o];if(!s){process.env.NODE_ENV!=="production"&&console.error("[vuex] unknown action type: "+o);return}try{this._actionSubscribers.slice().filter(function(c){return c.before}).forEach(function(c){return c.before(u,r.state)})}catch(c){process.env.NODE_ENV!=="production"&&(console.warn("[vuex] error in before action subscribers: "),console.error(c))}var d=s.length>1?Promise.all(s.map(function(c){return c(a)})):s[0](a);return new Promise(function(c,l){d.then(function(f){try{r._actionSubscribers.filter(function(h){return h.after}).forEach(function(h){return h.after(u,r.state)})}catch(h){process.env.NODE_ENV!=="production"&&(console.warn("[vuex] error in after action subscribers: "),console.error(h))}c(f)},function(f){try{r._actionSubscribers.filter(function(h){return h.error}).forEach(function(h){return h.error(u,r.state,f)})}catch(h){process.env.NODE_ENV!=="production"&&(console.warn("[vuex] error in error action subscribers: "),console.error(h))}l(f)})})},v.prototype.subscribe=function(t,i){return I(t,this._subscribers,i)},v.prototype.subscribeAction=function(t,i){var r=typeof t=="function"?{before:t}:t;return I(r,this._actionSubscribers,i)},v.prototype.watch=function(t,i,r){var n=this;return process.env.NODE_ENV!=="production"&&m(typeof t=="function","store.watch only accepts a function."),this._watcherVM.$watch(function(){return t(n.state,n.getters)},i,r)},v.prototype.replaceState=function(t){var i=this;this._withCommit(function(){i._vm._data.$$state=t})},v.prototype.registerModule=function(t,i,r){r===void 0&&(r={}),typeof t=="string"&&(t=[t]),process.env.NODE_ENV!=="production"&&(m(Array.isArray(t),"module path must be a string or an Array."),m(t.length>0,"cannot register the root module by using registerModule.")),this._modules.register(t,i),N(this,this.state,t,this._modules.get(t),r.preserveState),O(this,this.state)},v.prototype.unregisterModule=function(t){var i=this;typeof t=="string"&&(t=[t]),process.env.NODE_ENV!=="production"&&m(Array.isArray(t),"module path must be a string or an Array."),this._modules.unregister(t),this._withCommit(function(){var r=x(i.state,t.slice(0,-1));p.delete(r,t[t.length-1])}),R(this)},v.prototype.hasModule=function(t){return typeof t=="string"&&(t=[t]),process.env.NODE_ENV!=="production"&&m(Array.isArray(t),"module path must be a string or an Array."),this._modules.isRegistered(t)},v.prototype.hotUpdate=function(t){this._modules.update(t),R(this,!0)},v.prototype._withCommit=function(t){var i=this._committing;this._committing=!0,t(),this._committing=i},Object.defineProperties(v.prototype,k);function I(e,t,i){return t.indexOf(e)<0&&(i&&i.prepend?t.unshift(e):t.push(e)),function(){var r=t.indexOf(e);r>-1&&t.splice(r,1)}}function R(e,t){e._actions=Object.create(null),e._mutations=Object.create(null),e._wrappedGetters=Object.create(null),e._modulesNamespaceMap=Object.create(null);var i=e.state;N(e,i,[],e._modules.root,!0),O(e,i,t)}function O(e,t,i){var r=e._vm;e.getters={},e._makeLocalGettersCache=Object.create(null);var n=e._wrappedGetters,o={};g(n,function(u,s){o[s]=J(u,e),Object.defineProperty(e.getters,s,{get:function(){return e._vm[s]},enumerable:!0})});var a=p.config.silent;p.config.silent=!0,e._vm=new p({data:{$$state:t},computed:o}),p.config.silent=a,e.strict&&nt(e),r&&(i&&e._withCommit(function(){r._data.$$state=null}),p.nextTick(function(){return r.$destroy()}))}function N(e,t,i,r,n){var o=!i.length,a=e._modules.getNamespace(i);if(r.namespaced&&(e._modulesNamespaceMap[a]&&process.env.NODE_ENV!=="production"&&console.error("[vuex] duplicate namespace "+a+" for the namespaced module "+i.join("/")),e._modulesNamespaceMap[a]=r),!o&&!n){var u=x(t,i.slice(0,-1)),s=i[i.length-1];e._withCommit(function(){process.env.NODE_ENV!=="production"&&s in u&&console.warn('[vuex] state field "'+s+'" was overridden by a module with the same name at "'+i.join(".")+'"'),p.set(u,s,r.state)})}var d=r.context=Y(e,a,i);r.forEachMutation(function(c,l){var f=a+l;et(e,f,c,d)}),r.forEachAction(function(c,l){var f=c.root?l:a+l,h=c.handler||c;it(e,f,h,d)}),r.forEachGetter(function(c,l){var f=a+l;rt(e,f,c,d)}),r.forEachChild(function(c,l){N(e,t,i.concat(l),c,n)})}function Y(e,t,i){var r=t==="",n={dispatch:r?e.dispatch:function(o,a,u){var s=D(o,a,u),d=s.payload,c=s.options,l=s.type;if((!c||!c.root)&&(l=t+l,process.env.NODE_ENV!=="production"&&!e._actions[l])){console.error("[vuex] unknown local action type: "+s.type+", global type: "+l);return}return e.dispatch(l,d)},commit:r?e.commit:function(o,a,u){var s=D(o,a,u),d=s.payload,c=s.options,l=s.type;if((!c||!c.root)&&(l=t+l,process.env.NODE_ENV!=="production"&&!e._mutations[l])){console.error("[vuex] unknown local mutation type: "+s.type+", global type: "+l);return}e.commit(l,d,c)}};return Object.defineProperties(n,{getters:{get:r?function(){return e.getters}:function(){return tt(e,t)}},state:{get:function(){return x(e.state,i)}}}),n}function tt(e,t){if(!e._makeLocalGettersCache[t]){var i={},r=t.length;Object.keys(e.getters).forEach(function(n){if(n.slice(0,r)===t){var o=n.slice(r);Object.defineProperty(i,o,{get:function(){return e.getters[n]},enumerable:!0})}}),e._makeLocalGettersCache[t]=i}return e._makeLocalGettersCache[t]}function et(e,t,i,r){var n=e._mutations[t]||(e._mutations[t]=[]);n.push(function(a){i.call(e,r.state,a)})}function it(e,t,i,r){var n=e._actions[t]||(e._actions[t]=[]);n.push(function(a){var u=i.call(e,{dispatch:r.dispatch,commit:r.commit,getters:r.getters,state:r.state,rootGetters:e.getters,rootState:e.state},a);return Z(u)||(u=Promise.resolve(u)),e._devtoolHook?u.catch(function(s){throw e._devtoolHook.emit("vuex:error",s),s}):u})}function rt(e,t,i,r){if(e._wrappedGetters[t]){process.env.NODE_ENV!=="production"&&console.error("[vuex] duplicate getter key: "+t);return}e._wrappedGetters[t]=function(o){return i(r.state,r.getters,o.state,o.getters)}}function nt(e){e._vm.$watch(function(){return this._data.$$state},function(){process.env.NODE_ENV!=="production"&&m(e._committing,"do not mutate vuex store state outside mutation handlers.")},{deep:!0,sync:!0})}function x(e,t){return t.reduce(function(i,r){return i[r]},e)}function D(e,t,i){return V(e)&&e.type&&(i=t,t=e,e=e.type),process.env.NODE_ENV!=="production"&&m(typeof e=="string","expects string as the type, but found "+typeof e+"."),{type:e,payload:t,options:i}}function ot(e){if(p&&e===p){process.env.NODE_ENV!=="production"&&console.error("[vuex] already installed. Vue.use(Vuex) should be called only once.");return}p=e,B(p)}var st=U(function(e,t){var i={};return process.env.NODE_ENV!=="production"&&!C(t)&&console.error("[vuex] mapState: mapper parameter must be either an Array or an Object"),F(t).forEach(function(r){var n=r.key,o=r.val;i[n]=function(){var u=this.$store.state,s=this.$store.getters;if(e){var d=G(this.$store,"mapState",e);if(!d)return;u=d.context.state,s=d.context.getters}return typeof o=="function"?o.call(this,u,s):u[o]},i[n].vuex=!0}),i}),at=U(function(e,t){var i={};return process.env.NODE_ENV!=="production"&&!C(t)&&console.error("[vuex] mapGetters: mapper parameter must be either an Array or an Object"),F(t).forEach(function(r){var n=r.key,o=r.val;o=e+o,i[n]=function(){if(!(e&&!G(this.$store,"mapGetters",e))){if(process.env.NODE_ENV!=="production"&&!(o in this.$store.getters)){console.error("[vuex] unknown getter: "+o);return}return this.$store.getters[o]}},i[n].vuex=!0}),i});function F(e){return C(e)?Array.isArray(e)?e.map(function(t){return{key:t,val:t}}):Object.keys(e).map(function(t){return{key:t,val:e[t]}}):[]}function C(e){return Array.isArray(e)||V(e)}function U(e){return function(t,i){return typeof t!="string"?(i=t,t=""):t.charAt(t.length-1)!=="/"&&(t+="/"),e(t,i)}}function G(e,t,i){var r=e._modulesNamespaceMap[i];return process.env.NODE_ENV!=="production"&&!r&&console.error("[vuex] module namespace not found in "+t+"(): "+i),r}const y={_initializeTimer(e){return{id:0,method:e.method,time:e.time||1e3,immediate:e.immediate,force:e.force,autostart:e.autostart,edit:e.edit,spinner:e.spinner,isRunning:!1,destroyed:!1}},_getTimer(e,t){let i;switch(typeof t){case"function":i=e[t.name],i.autostart=!0;break;case"string":i=e[t],i.autostart=!0;break;default:if(!t.method)throw new Error("[timer]: method cannot be resumed, because it was not defined previously.");if(typeof t.method!="function")throw new Error("[timer]: provided method must be a function.");e[t.method.name]?(i=e[t.method.name],i.autostart=!0):(e[t.method.name]=this._initializeTimer(t),i=e[t.method.name])}return i},_filterTimers(e,t){let i=Object.values(t).filter(r=>r.autostart);switch(e){case"edit":i=i.filter(r=>!r.edit);break;case"spinner":i=i.filter(r=>!r.spinner);break}return i},_syncTimer(e){e.id=setTimeout((async function t(){e.isRunning&&(await e.method(),e.id=setTimeout(t.bind(this),e.time))}).bind(this),this._immediateStart(e))},_asyncTimer(e){e.id=setTimeout(()=>{e.isRunning&&(e.id=setInterval(()=>e.method(),e.time))},this._immediateStart(e))},_immediateStart(e){return e.immediate?0:e.time}},ct={mixins:[{methods:{timer(){let e={};this.$timer={start:t=>{const i=y._getTimer(e,t);i.isRunning||!i.autostart||i.destroyed||(i.isRunning=!0,i.force?y._asyncTimer(i):y._syncTimer(i))},stop:t=>{const i=y._getTimer(e,t);i&&(i.isRunning=!1,i.force?clearInterval(i.id):clearTimeout(i.id))},destroy:t=>{const i=y._getTimer(e,t);i&&(i.destroyed=!0)},update:t=>{const i=y._getTimer(e,t);if(!i)throw new Error("[timer]: cannot update a non existing timer.");i.isRunning&&this.$timer.stop(i.method),e[t.method.name]=y._initializeTimer(t),this.$timer.start(i.method)},stopAll:t=>{const i=y._filterTimers(t,e);i.length!==0&&i.forEach(r=>this.$timer.stop(r.method))},startAll:t=>{const i=y._filterTimers(t,e);i.length!==0&&i.forEach(r=>this.$timer.start(r.method))},destroyAll:t=>{Object.values(e).forEach(i=>this.$timer.destroy(i.method)),this.$timer.stopAll()},clear:()=>{this.$timer.stopAll(),e={}}}}},computed:{...at(["modalOpen"]),...st(["spinning"])},watch:{modalOpen(e){e?this.$timer.stopAll("edit"):this.$timer.startAll("edit")},spinning(e){this.modalOpen||(e?this.$timer.stopAll("spinner"):this.$timer.startAll("spinner"))}},created(){this.timer()},beforeDestroy(){this.$timer.destroyAll()}}],provide(){return{formOptions:this.getFormOptions}},data(){return{dynamicDNSEditModal:z,dateTranslations:{_runonce_:this.$t("Run once"),_disabled_:this.$t("Disabled"),_stopped_:this.$t("Stopped"),_never_:this.$t("Never"),_neverupdated_:"-"},ddns:{},statuses:{},formOptions:{interfaceData:[],hasSsl:!1,providerData:{}}}},methods:{overviewColumns(e){const t=this.statuses[e.id];return{item:e,columns:[[{label:this.$t("Status"),value:this.getStatus(t),class:t!=null&&t.is_up?"success":"error"},{label:this.$t("Hostname"),value:(t==null?void 0:t.lookup)||"-"},{label:this.$t("IP"),value:(t==null?void 0:t.reg_ip)||"-"}],[{label:this.$t("Last Update"),value:this.getDateTranslation(e.id,"datelast")},{label:this.$t("Next Update"),value:this.getDateTranslation(e.id,"datenext")}],[{label:this.$t("Check Interval"),value:(t==null?void 0:t.check)||"-"},{label:this.$t("Force Interval"),value:(t==null?void 0:t.force)||"-"}]]}},getDateTranslation(e,t){const i=this.statuses[e];return i?this.dateTranslations[i[t]]||i[t]:"-"},getStatus(e){return e!=null&&e.is_up?this.$t("Running"):this.$t("Stopped")},getFormOptions(){return this.formOptions},loadData(){const e=["/api/interfaces/config","/api/ddns/options"];return this.$axios.bulkGet(e).then(([t,i])=>(this.formOptions={interfaceData:t.success?t.data:this.formOptions.interfaceData,hasSsl:i.success?i.data.env_info.has_ssl:this.formOptions.hasSsl,providerData:i.success?i.data.service_providers:this.formOptions.providerData},{})).finally(()=>{this.$timer.start({method:this.getDdnsStatuses,time:5e3,autostart:!0,immediate:!1})})},getDdnsStatuses(){return this.$axios.get("/api/ddns/status").then(({data:e})=>{this.statuses={},e.forEach(t=>{this.$set(this.statuses,t.section,t)})}).catch(()=>{this.$message.error(this.$t("Failed to get DDNS instances status"))})},instanceExists(e){return this.ddns.service.some(t=>t.id===e)?{isValid:!1,message:this.$t("Instance '%s' already exists").format(e)}:{isValid:!0}},handleEditErrors(e){const t=e.payload[0].errors[0].section;return this.$t("Saving failed: DDNS instance '%s' cannot be enabled due to invalid configuration").format(t)}}};var ut=function(){var t=this,i=t._self._c;return i("vuci-form",{attrs:{config:"ddns","after-load":t.loadData},scopedSlots:t._u([{key:"default",fn:function({uciData:r}){return[i("vuci-typed-section",{attrs:{type:"service","uci-data":r,"edit-form":t.dynamicDNSEditModal,title:t.$t("Dynamic DNS overview"),help:t.$t("This section displays a list of existing DDNS instances.      If you wish to edit the settings of an instance,      click the button that looks like a pencil next to it."),"data-key":"service",endpoints:[{endpoint:"ddns/config"}],"custom-design":"","error-handlers":{edit:t.handleEditErrors}},scopedSlots:t._u([{key:"custom-design",fn:function({s:n,index:o,actions:a}){return[i("tlt-horizontal-card",{staticClass:"mb-4",attrs:{"test-id":`rowCard-${n.id}`,"card-props":t.overviewColumns(n)},scopedSlots:t._u([{key:"default",fn:function({props:{columns:u}}){return[i("name-cell",{attrs:{index:o+1,value:n.id}}),t._l(u,function(s,d){return i("card-cell",{key:d,attrs:{columns:s}},t._l(s,function(c,l){return i("cell-row",{key:l,attrs:{label:c.label},scopedSlots:t._u([{key:"value",fn:function(){return[i("span",{class:c.class},[t._v(t._s(c.value))])]},proxy:!0}],null,!0)})}),1)}),i("action-cell",[i("cell-row",{attrs:{label:t.$t("Actions"),"only-mobile-label":""},scopedSlots:t._u([{key:"value",fn:function(){return[i("vuci-form-edit-delete",{staticClass:"xl:min-w-max",attrs:{id:n.id,actions:a}})]},proxy:!0}],null,!0)})],1),i("action-cell",[i("cell-row",{attrs:{label:t.$t("Enable"),"only-mobile-label":""},scopedSlots:t._u([{key:"value",fn:function(){return[i("vuci-form-item-switch",{staticClass:"xl:min-w-max",attrs:{"uci-section":n,name:"enabled"}})]},proxy:!0}],null,!0)})],1)]}}],null,!0)})]}},{key:"addForm",fn:function({addModel:n}){return[i("tlt-form-item-input",{attrs:{label:t.$t("DDNS name"),help:t.$t("Name of the new DDNS"),prop:"id",rules:o=>[o.uciname,t.instanceExists],required:""},model:{value:n.id,callback:function(o){t.$set(n,"id",o)},expression:"addModel.id"}})]}}],null,!0)})]}}]),model:{value:t.ddns,callback:function(r){t.ddns=r},expression:"ddns"}})},lt=[],dt=$(ct,ut,lt,!1,null,null,null,null);return dt.exports});
