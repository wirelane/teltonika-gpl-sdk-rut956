(function(l,u){typeof exports=="object"&&typeof module<"u"?module.exports=u():typeof define=="function"&&define.amd?define(u):(l=typeof globalThis<"u"?globalThis:l||self,l["services/Trap_js"]=u())})(this,function(){"use strict";function l(i,t,e,r,s,h,c,T){var n=typeof i=="function"?i.options:i;t&&(n.render=t,n.staticRenderFns=e,n._compiled=!0),r&&(n.functional=!0),h&&(n._scopeId="data-v-"+h);var o;if(c?(o=function(a){a=a||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!a&&typeof __VUE_SSR_CONTEXT__<"u"&&(a=__VUE_SSR_CONTEXT__),s&&s.call(this,a),a&&a._registeredComponents&&a._registeredComponents.add(c)},n._ssrRegister=o):s&&(o=T?function(){s.call(this,(n.functional?this.parent:this).$root.$options.shadowRoot)}:s),o)if(n.functional){n._injectStyles=o;var S=n.render;n.render=function(N,m){return o.call(m),S(N,m)}}else{var p=n.beforeCreate;n.beforeCreate=p?[].concat(p,o):[o]}return{exports:i,options:n}}const u={inject:["formOptions"],props:{section:{type:Object,required:!0}},data(){return{gsmNames:[["signalstrtrap",this.$t("Signal strength")],["conntypetrap",this.$t("Network type")]],chilliNames:[["connectedtrap",this.$t("Connected")],["disconnectedtrap",this.$t("Disconnected")]],chilliInstalled:this.$store.state.packages.includes("/usr/lib/opkg/info/coova-chilli.control"),eventsInstalled:this.$store.state.packages.includes("/usr/lib/opkg/info/events_reporting.control"),formData:{}}},computed:{modems(){return this.$mobile.modemsOptions(this.formOptions().modems)},ioPins(){return this.formOptions().ioPins},eventType(){return this.$eventsOptions.getTranslatedTypes(this.formOptions().events)},translatedSubtypes(){return this.$eventsOptions.getTranslatedSubtypes(this.formOptions().events)},eventSubtypes(){return this.translatedSubtypes[this.section.event]||[]},trapTypes(){const i=[];return this.formOptions().modems.length>0&&i.push(["gsm",this.$t("GSM")]),this.$store.state.board.hwinfo.ios&&i.push(["iotrap",this.$t("Input/Output")]),this.eventsInstalled&&i.push(["eventtrap",this.$t("Events log")]),this.chilliInstalled&&i.push(["chilli",this.$t("Hotspot client")]),i},nameProps(){return this.section.type==="iotrap"?this.ioPins:this.section.type==="gsm"?this.gsmNames:this.section.type==="chilli"?this.chilliNames:[]},fromProps(){var i;return(i=this.section.name)!=null&&i.match("adc")?{label:this.$t("Min voltage"),help:this.$t("Specifies minimum voltage of the range."),placeholder:"0.0",rules:["ufloat",t=>this.lessThan(t,this.section.to)]}:{label:this.$t("Min current"),help:this.$t("Specifies minimum current of the range. Values between 4-20mA."),placeholder:"4.0",rules:["ufloat","range(4,20)",t=>this.lessThan(t,this.section.to)]}},toProps(){var i;return(i=this.section.name)!=null&&i.match("adc")?{label:this.$t("Max voltage"),help:this.$t("Specifies maximum voltage of the range."),rules:["ufloat",t=>this.moreThan(t,this.section.from)]}:{label:this.$t("Max current"),help:this.$t("Specifies maximum current of the range. Values between 4-20mA."),rules:["ufloat","range(4,20)",t=>this.moreThan(t,this.section.from)]}},stateChanges(){if(this.section.type!=="iotrap")return[];const i=[["both",this.$t("Both")]];return["din1","din2","dout1","dout2","iio","dio0","dio1","dio2"].includes(this.section.name)&&i.push(["active",this.$t("High level")],["inactive",this.$t("Low level")]),["relay0","relay1"].includes(this.section.name)&&i.push(["open",this.$t("Open")],["closed",this.$t("Closed")]),["dwi0","dwi1"].includes(this.section.name)&&i.push(["rising",this.$t("Rising")],["falling",this.$t("Falling")]),["adc0","acl0"].includes(this.section.name)&&i.push(["in_range",this.$t("In range")],["out_of_range",this.$t("Out of range")]),i}},methods:{lessThan(i,t){return parseFloat(i)>=parseFloat(t)?{isValid:!1,message:this.$t("Min value should be less than Max value.")}:{isValid:!0}},moreThan(i,t){return parseFloat(i)<=parseFloat(t)?{isValid:!1,message:this.$t("Max value should be more than Min value.")}:{isValid:!0}}}};var d=function(){var t=this,e=t._self._c;return e("vuci-form",{attrs:{config:"snmptrap",editing:""},scopedSlots:t._u([{key:"default",fn:function({uciData:r}){return[e("vuci-named-section",{attrs:{name:t.section.id,title:t.$t("Modify trap rule"),help:t.$t("This section is used to configure the settings of the SNMP trap rule. Scroll your mouse pointer over field names in order to see helpful hints."),"uci-data":r,"data-key":"rules",endpoints:[{endpoint:"snmp/trap/config"}]},scopedSlots:t._u([{key:"default",fn:function({s}){return[e("vuci-form-item-switch",{attrs:{"uci-section":s,label:t.$t("Enable"),help:t.$t("Enable SNMP trap rule."),name:"enabled"}}),e("vuci-form-item-select",{attrs:{"uci-section":s,label:t.$t("Trap type"),name:"type",options:t.trapTypes}}),e("vuci-form-item-select",{attrs:{"uci-section":s,label:t.$t("Modem"),help:t.$t("Trap will be set for selected modem."),name:"modem",options:t.modems,depend:t.modems.length>1&&s.type==="gsm"}}),e("vuci-form-item-select",{attrs:{"uci-section":s,name:"name",label:t.$t("Trigger"),help:t.$t("The trigger which invokes the rule."),depend:s.type!=="eventtrap",options:t.nameProps}}),e("vuci-form-item-input",{attrs:{"uci-section":s,label:t.$t("Signal strength"),help:t.$t("GSM signal strength value. If the routers signal strength falls below this threshold it will trigger the SNMP trap."),name:"signal",rules:"irange(-130,0)",required:s.enabled==="1",placeholder:"-59",depend:s.name==="signalstrtrap"}}),e("vuci-form-item-select",{attrs:{"uci-section":s,label:t.$t("State change"),help:t.$t("Selects which pin state will trigger the SNMP trap."),name:"state",options:t.stateChanges,depend:s.type==="iotrap"}}),e("vuci-form-item-select",{attrs:{"uci-section":s,name:"event",label:t.$t("Event"),help:t.$t("The string for which to look for in the event's message."),depend:s.type==="eventtrap",options:t.eventType}}),e("vuci-form-item-select",{attrs:{"uci-section":s,name:"event_mark",label:t.$t("Event subtype"),help:t.$t("The string for which to look for in the event's message."),depend:s.type==="eventtrap",options:t.eventSubtypes}}),e("vuci-form-item-input",t._b({attrs:{"uci-section":s,name:"from",depend:s.name==="adc0"||s.name==="acl0",required:s.enabled==="1"}},"vuci-form-item-input",t.fromProps,!1)),e("vuci-form-item-input",t._b({attrs:{"uci-section":s,name:"to",placeholder:"12.5",depend:s.name==="adc0"||s.name==="acl0",required:s.enabled==="1"}},"vuci-form-item-input",t.toProps,!1))]}}],null,!0)})]}}]),model:{value:t.formData,callback:function(r){t.formData=r},expression:"formData"}})},f=[],g=l(u,d,f,!1,null,null,null,null);const $=g.exports,v={provide(){return{formOptions:this.getFormOptions}},data(){return{editForm:$,modems:[],ios:[],events:[],trapRulesColumns:[{name:"name",label:this.$t("Trap type")},{name:"type",label:this.$t("Trigger"),help:this.$t("The trigger which invokes the rule.")},{name:"enabled",label:this.$t("")}],trapTypes:{gsm:this.$t("GSM"),iotrap:this.$t("Input/Output"),eventtrap:this.$t("Events log"),chilli:this.$t("Hotspot client")},trapNames:{signalstrtrap:this.$t("Signal strength"),conntypetrap:this.$t("Network type")},chilliNames:{connectedtrap:this.$t("Connected"),disconnectedtrap:this.$t("Disconnected")}}},computed:{ioPins(){return this.$io.getFilteredPinsInfo(this.ios).filter(i=>["gpio","dwi","relay","adc","acl"].includes(i.type)).map(i=>[i.id,i.name_with_pins])},ioPinsObj(){const i={};return this.ioPins.forEach(([t,e])=>{i[t]=e}),i}},methods:{getFormOptions(){return{modems:this.modems,ioPins:this.ioPins,events:this.events}},afterLoad(){return this.$axios.bulkGet([{endpoint:"/api/modems/status",condition:"mobifd.control"},{endpoint:"/api/io/status",condition:"iomand.control"},{endpoint:"/api/events_reporting/options",condition:"events_reporting.control"}]).then(([i,t,e])=>{i.success?this.modems=i.data:this.$message.error(this.$t("Failed to load modem info")),t.success?this.ios=t.success&&t.data?t.data:[]:this.$message.error(this.$t("Failed to load io status")),e.success?this.events=e.data.events:this.$message.error(this.$t("Failed to load events")),t.data||this.$alert.error(this.$t("Input/output functionality is booting, page will have missing input/output functionality, please wait a few minutes and refresh the page to fix it."))}).catch(()=>{this.$message.error(this.$t("An unexpected error has occurred"))})},displayType(i,{uciSection:{type:t}}){return this.trapTypes[t]||this.$t("N/A")},displayName(i,{uciSection:{type:t,name:e,event:r}}){return t==="gsm"?this.trapNames[e]||this.$t("N/A"):t==="iotrap"?this.ioPinsObj[e]||this.$t("N/A"):t==="eventtrap"?this.$eventsOptions.getTypes()[r]||this.$t("N/A"):t==="chilli"?this.chilliNames[e]||this.$t("N/A"):this.$t("N/A")},isNameSet(i){return!!i.name},validateEnable(i){const t=i.uciSection;if(i.model==="0"||t.enabled!=="1")return;const e=[];switch(t.type){case"gsm":this.isNameSet(t)||e.push(this.$t("Trigger")),t.name==="signalstrtrap"&&!t.signal&&e.push(this.$t("Signal strength"));break;case"iotrap":this.isNameSet(t)||e.push(this.$t("Trigger")),t.state||e.push(this.$t("State change")),(t.name.match("acl")||t.name.match("adc"))&&!t.from&&e.push(t.name.match("acl")?this.$t("Min current"):this.$t("Min voltage")),(t.name.match("acl")||t.name.match("adc"))&&!t.to&&e.push(t.name.match("acl")?this.$t("Max current"):this.$t("Max voltage"));break;case"eventtrap":t.event||e.push(this.$t("Event")),t.event_mark||e.push(this.$t("Event subtype"));break;case"chilli":this.isNameSet(t)||e.push(this.$t("Trigger"));break;default:e.push(this.$t("Trap type")),this.isNameSet(t)||e.push(this.$t("Trigger"));break}e.length===1&&(this.$message.error(this.$t("Missing required option: %s").format(e)),i.model="0"),e.length>1&&(this.$message.error(this.$t("Missing required options: %s").format(e.join(", "))),i.model="0")}}};var b=function(){var t=this,e=t._self._c;return e("vuci-form",{attrs:{config:"snmptrap","after-load":t.afterLoad},scopedSlots:t._u([{key:"default",fn:function({uciData:r}){return[e("vuci-named-section",{attrs:{title:t.$t("Trap service settings"),help:t.$t("This section is used to configure trap service settings."),"uci-data":r,"data-key":"settings",endpoints:[{endpoint:"snmp/trap/global"}]},scopedSlots:t._u([{key:"default",fn:function({s}){return[e("vuci-form-item-switch",{attrs:{"uci-section":s,name:"enabled",label:t.$t("Enable")}}),e("vuci-form-item-input",{attrs:{"uci-section":s,name:"host",label:t.$t("Host"),rules:"host",placeholder:"myhost.example.com",help:t.$t("Host to transfer SNMP (Simple Network Management Protocol) traffic to."),required:s.enabled==="1"}}),e("vuci-form-item-input",{attrs:{"uci-section":s,name:"port",label:t.$t("Port"),rules:"port",initial:"162",help:t.$t("Port for trap host."),required:s.enabled==="1"}}),e("vuci-form-item-input",{attrs:{"uci-section":s,name:"community",label:t.$t("Community"),initial:"Public",rules:"uciname",maxlength:"31",help:t.$t("The SNMP (Simple Network Management Protocol) community is an ID that allows access to a routers SNMP data."),required:s.enabled==="1"}})]}}],null,!0)}),e("vuci-typed-section",{attrs:{type:"trap","edit-form":t.editForm,columns:t.trapRulesColumns,title:t.$t("Trap rules"),help:t.$t("This section displays SNMP trap configurations currently existing on the router."),"uci-data":r,"data-key":"rules",endpoints:[{endpoint:"snmp/trap/config"}]},scopedSlots:t._u([{key:"name",fn:function({s}){return[e("vuci-form-item-dummy",{attrs:{"uci-section":s,name:"name","display-value":t.displayType}})]}},{key:"type",fn:function({s}){return[e("vuci-form-item-dummy",{attrs:{"uci-section":s,name:"type","display-value":t.displayName}})]}},{key:"enabled",fn:function({s}){return[e("vuci-form-item-switch",{attrs:{"uci-section":s,name:"enabled"},on:{change:t.validateEnable}})]}}],null,!0)})]}}])})},y=[],_=l(v,b,y,!1,null,null,null,null);return _.exports});
