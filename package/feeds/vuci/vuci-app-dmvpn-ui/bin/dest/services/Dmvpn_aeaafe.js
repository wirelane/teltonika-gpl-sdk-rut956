(function(l,u){typeof exports=="object"&&typeof module<"u"?module.exports=u():typeof define=="function"&&define.amd?define(u):(l=typeof globalThis<"u"?globalThis:l||self,l["services/Dmvpn_js"]=u())})(this,function(){"use strict";function l(n,e,t,r,o,i,d,k){var a=typeof n=="function"?n.options:n;e&&(a.render=e,a.staticRenderFns=t,a._compiled=!0),r&&(a.functional=!0),i&&(a._scopeId="data-v-"+i);var c;if(d?(c=function(s){s=s||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!s&&typeof __VUE_SSR_CONTEXT__<"u"&&(s=__VUE_SSR_CONTEXT__),o&&o.call(this,s),s&&s._registeredComponents&&s._registeredComponents.add(d)},a._ssrRegister=c):o&&(c=k?function(){o.call(this,(a.functional?this.parent:this).$root.$options.shadowRoot)}:o),c)if(a.functional){a._injectStyles=c;var P=a.render;a.render=function(w,h){return c.call(h),P(w,h)}}else{var p=a.beforeCreate;a.beforeCreate=p?[].concat(p,c):[c]}return{exports:n,options:a}}const u={inject:["formOptions"],props:{section:{type:Object,required:!0}},data(){return{formData:{},modeOptions:[["spoke",this.$t("Spoke")],["hub",this.$t("Hub")]],encryption:[["3des","3DES"],["des","DES"],["aes128","AES 128"],["aes192","AES 192"],["aes256","AES 256"],["aes128gcm8","AES128 GCM8"],["aes192gcm8","AES192 GCM8"],["aes256gcm8","AES256 GCM8"],["aes128gcm12","AES128 GCM12"],["aes192gcm12","AES192 GCM12"],["aes256gcm12","AES256 GCM12"],["aes128gcm16","AES128 GCM16"],["aes192gcm16","AES192 GCM16"],["aes256gcm16","AES256 GCM16"]],hashOptions:[["md5","MD5"],["sha1","SHA1"],["sha256","SHA256"],["sha384","SHA384"],["sha512","SHA512"]],dhOptions:[["modp768","MODP768"],["modp1024","MODP1024"],["modp1536","MODP1536"],["modp2048","MODP2048"],["modp3072","MODP3072"],["modp4096","MODP4096"],["ecp192","ECP192"],["ecp224","ECP224"],["ecp256","ECP256"],["ecp384","ECP384"],["ecp521","ECP521"]],pfs:[["no_pfs",this.$t("No PFS")]],tabs:[{tab:"phase1",title:this.$t("Phase 1")},{tab:"phase2",title:this.$t("Phase 2")}],nhrp:this.$store.getters.hasPackages("frr-nhrp")||this.$store.getters.hasPackages("frr5-nhrp")}},computed:{greOptions(){return this.formOptions().gre.map(n=>["%s_static".format(n.id),"%s_static".format(n.id.toUpperCase())+"(@%s)".format(n.id)])},tunnelOptions(){const n=[["any",this.$t("Any")]];return this.formOptions().interfaces.forEach(e=>{var t,r;if(e.ifname!=="lo")if(e.proto==="pppoe"||e.proto==="static"||e.proto==="dhcp"){const o=e.ifname??this.$t("No physical interface");n.push([e.id,((t=this.$network.getName(e))==null?void 0:t.toUpperCase())+" ("+o+")"])}else(e.proto==="wwan"||e.proto==="connm")&&n.push([e.id+"_4",(r=this.$network.getName(e))==null?void 0:r.toUpperCase()])}),n.concat(this.greOptions)}},methods:{getCipherWarning(n){if(n==="des"||n==="3des")return this.$t("This privacy type is not considered secure. Consider using a more secure privacy type, such as AES.")},nflogAndNhrpValidation(n,e){const t=e.uciSection;return t.multicast_nflog_group===t.nflog_group?{isValid:!1,message:this.$t("'NFLOG group' and 'NHRP multicast NFLOG group' values must differ")}:{isValid:!0}},tunnelValidation(n){this.$VuciValidator.value=n;const e=this.$VuciValidator.ip4addr(),t=this.$VuciValidator.uciname();return e.isValid||t.isValid?{isValid:!0}:{isValid:!1,message:this.$t("A string of a-Z, 0-9 and _ characters or IPv4 addresses are accepted. E.g. 192.168.1.1.")}}}};var m=function(){var e=this,t=e._self._c;return t("vuci-form",{attrs:{config:"dmvpn",editing:""},scopedSlots:e._u([{key:"default",fn:function({uciData:r,editableSection:o}){return[t("vuci-named-section",{attrs:{"uci-data":r,"data-key":"dmvpn",endpoints:[{endpoint:"dmvpn/config"}],name:o.id},scopedSlots:e._u([{key:"default",fn:function({s:i}){return[t("tlt-card",{attrs:{title:e.$t("DMVPN Parameters Configuration"),help:e.$t("This section is used to configure the settings of the %s dmvpn instance.                  Scroll your mouse pointer over field names in order to see helpful hints.".format(e.section.id))}},[t("vuci-form-item-switch",{attrs:{"uci-section":i,label:e.$t("Enable"),help:e.$t("Turns the DMVPN instance on or off."),name:"enabled"}}),t("vuci-form-item-select",{attrs:{"uci-section":i,label:e.$t("Working mode"),help:e.$t("Selects the role of this instance                               Hub - the central instance of DMVPN that connects other peers (spokes) into single network.                               There is no need to reconfigure the hub when connecting new spokes to it.                               Spoke - an instance that connects to the hub."),name:"config_mode",options:e.modeOptions}}),t("vuci-form-item-input",{attrs:{"uci-section":i,label:e.$t("Hub address"),help:e.$t("IP address or hostname of a DMVPN Hub."),name:"hub_address",placeholder:"0.0.0.0",rules:"host",depend:i.config_mode==="spoke"}})],1),t("tlt-card",{attrs:{title:e.$t("GRE Parameters Configuration")}},[t("vuci-form-item-select",{attrs:{"uci-section":i,label:e.$t("Tunnel source"),help:e.$t("IP address of the local WAN interface."),name:"ipaddr_tunlink","allow-create":"",rules:e.tunnelValidation,maxlength:"16",options:e.tunnelOptions}}),t("vuci-form-item-input",{attrs:{"uci-section":i,label:e.$t("Local GRE interface IP address"),help:e.$t("IP address of the local GRE tunnel device."),name:"gre_ipaddr",placeholder:"192.168.1.115",rules:"ip4addr"}}),t("vuci-form-item-input",{attrs:{depend:i.config_mode==="hub","uci-section":i,label:e.$t("Local GRE interface netmask"),help:e.$t("Netmask of the local GRE tunnel device."),name:"netmask",placeholder:"255.255.255.0",rules:"netmask"}}),t("vuci-form-item-input",{attrs:{depend:i.config_mode==="spoke","uci-section":i,label:e.$t("Remote GRE interface IP address"),help:e.$t("IP address of the remote GRE tunnel device."),name:"gre_remote_ipaddr",placeholder:"0.0.0.0",rules:"ip4addr"}}),t("vuci-form-item-input",{attrs:{"uci-section":i,label:e.$t("GRE MTU"),help:e.$t("MTU size of GRE Tunnel device"),name:"mtu",placeholder:"1476",rules:"irange(68,9200)"}}),t("vuci-form-item-input",{attrs:{"uci-section":i,name:"okey",label:e.$t("Outbound key"),help:e.$t(`Key for outgoing packets.
            This value should match the 'Inbound key' value set on the opposite GRE instance or both key values should be omitted on both sides.
            Allowed range [0-65535]`),placeholder:"65000",rules:"range(0, 65535)"}}),t("vuci-form-item-input",{attrs:{"uci-section":i,name:"ikey",label:e.$t("Inbound key"),help:e.$t(`Key for incoming packets.
            This value should match the 'Outbound key' value set on the opposite GRE instance or both key values should be omitted on both sides.
            Allowed range [0-65535]`),placeholder:"65000",rules:"range(0, 65535)"}})],1),t("tlt-card",{attrs:{title:e.$t("IPsec Parameters Configuration")}},[t("vuci-form-item-input",{attrs:{"uci-section":i,label:e.$t("Local identifier"),help:e.$t("How the left participant should be identified for authentication."),name:"local_identifier",rules:"string",placeholder:"IP, FQDN"}}),t("vuci-form-item-input",{attrs:{"uci-section":i,label:e.$t("Remote identifier"),help:e.$t("How the right participant should be identified for authentication."),name:"remote_identifier",rules:"string",placeholder:"IP, FQDN"}}),t("vuci-form-item-input",{attrs:{"uci-section":i,label:e.$t("Pre-shared key"),help:e.$t("A shared password to authenticate between the peers. All characters are allowed except ` and space"),name:"pre_shared_key",rules:"credentials_validate('allow-space')",minlength:"5",placeholder:"key",password:"",required:""}})],1),t("tlt-card",{attrs:{title:e.$t("IPsec Proposal Configuration")}},[t("tlt-tabs",{attrs:{tabs:e.tabs},scopedSlots:e._u([{key:"phase1",fn:function(){return[t("vuci-form-item-select",{attrs:{"uci-section":i,label:e.$t("Encryption algorithm"),help:e.$t("The encryption algorithm must match with another incoming connection to establish IPSec"),options:e.encryption,warnings:e.getCipherWarning,name:"encryption_algorithm",initial:"aes128"}}),t("vuci-form-item-select",{attrs:{"uci-section":i,label:e.$t("Authentication"),help:e.$t("The authentication algorithm must match with another incoming connection to establish IPSec"),name:"hash_algorithm",initial:"sha1",options:e.hashOptions}}),t("vuci-form-item-select",{attrs:{"uci-section":i,label:e.$t("DH group"),help:e.$t("The DH (Diffie-Hellman) group must match with another incoming connection to establish IPSec"),name:"dh_group",initial:"modp1024",options:e.dhOptions}}),t("vuci-form-item-switch",{attrs:{"uci-section":i,label:e.$t("Force crypto proposal"),help:e.$t("Only chosen proposals will be used"),name:"force_crypto_proposal"}}),t("vuci-form-item-input",{attrs:{"uci-section":i,label:e.$t("IKE lifetime"),help:e.$t(`How long the keying channel of a connection (ISAKMP or IKE SA) should last before being
                          renegotiated. The time is specified in seconds. The s, m, h and d suffixes explicitly define the units for
                          seconds, minutes, hours and days, respectively.`),name:"ikelifetime",placeholder:"3h",maxlength:"7",rules:"fieldvalidation('^[0-9]+[smhd]?$')"}})]},proxy:!0},{key:"phase2",fn:function(){return[t("vuci-form-item-select",{attrs:{"uci-section":i,label:e.$t("Encryption algorithm"),help:e.$t("The encryption algorithm must match with another incoming connection to establish IPSec"),options:e.encryption,warnings:e.getCipherWarning,name:"encryption_algorithm_2"}}),t("vuci-form-item-select",{attrs:{"uci-section":i,label:e.$t("Hash algorithm"),help:e.$t("The hash algorithm must match with another incoming connection to establish IPSec"),name:"hash_algorithm_2",options:e.hashOptions}}),t("vuci-form-item-select",{attrs:{"uci-section":i,label:e.$t("PFS group"),help:e.$t("The DH (Diffie-Hellman) group must match with another incoming connection to establish IPSec"),name:"dh_group_2",options:e.dhOptions.concat(e.pfs)}}),t("vuci-form-item-switch",{attrs:{"uci-section":i,label:e.$t("Force crypto proposal"),help:e.$t("Only chosen proposals will be used"),name:"force_crypto_proposal_2"}}),t("vuci-form-item-input",{attrs:{"uci-section":i,label:e.$t("Lifetime"),help:e.$t(`How long a particular instance of a connection (a set of encryption/authentication keys
                          for user packets) should last, from successful negotiation to expiry. The time is specified in seconds.
                          The s, m, h and d suffixes explicitly define the units for seconds, minutes, hours and days, respectively.`),name:"lifetime",placeholder:"3h",rules:"fieldvalidation('^[0-9]+[smhd]?$')",maxlength:"7"}})]},proxy:!0}],null,!0)})],1),e.nhrp?t("tlt-card",{attrs:{title:e.$t("NHRP Parameters Configuration")}},[t("vuci-form-item-input",{attrs:{"uci-section":i,label:e.$t("NHRP network ID"),help:e.$t("NHRP network identifier"),name:"network_id",rules:"range(1,4294967295)",placeholder:"1"}}),t("vuci-form-item-input",{attrs:{"uci-section":i,label:e.$t("NHRP authentication key"),help:e.$t("NHRP authentication key"),name:"auth",rules:"uciname",maxlength:"8",placeholder:"12346578"}}),t("vuci-form-item-input",{attrs:{"uci-section":i,label:e.$t("NHRP hold time"),help:e.$t(`Specifies the holding time for NHRP Registration Requests and Resolution Replies sent from
                    this interface or shortcut-target. The holdtime is specified in seconds and defaults to two hours.`),name:"holdtime",rules:"range(1,65000)",placeholder:"7200"}}),t("vuci-form-item-switch",{attrs:{"uci-section":i,label:e.$t("Redirect"),help:e.$t("Allow DMVPN traffic redirection (Phase 3)"),name:"redirect"}}),t("vuci-form-item-input",{attrs:{"uci-section":i,label:e.$t("NFLOG group"),help:e.$t("Specify NFLOG group to be used by NHRP instance"),name:"nflog_group",rules:[e.nflogAndNhrpValidation,"range(1,65535)"],placeholder:"1-65535",depend:i.config_mode==="hub"}}),t("vuci-form-item-switch",{attrs:{"uci-section":i,label:e.$t("Multicast"),help:e.$t("Allow use of dynamic routing protocols that use multicast"),name:"multicast",depend:e.nhrp&&i.config_mode==="spoke"}}),t("vuci-form-item-input",{attrs:{"uci-section":i,label:e.$t("NHRP multicast NFLOG group"),help:e.$t("Specify NFLOG group to be used by NHRP instance for multicast traffic"),name:"multicast_nflog_group",rules:[e.nflogAndNhrpValidation,"range(1,65535)"],placeholder:"1-65535",depend:e.nhrp&&(i.config_mode==="spoke"&&i.multicast==="1"||i.config_mode==="hub")}})],1):e._e()]}}],null,!0)})]}}])})},f=[],g=l(u,m,f,!1,null,null,null,null);const $=g.exports,_={provide(){return{formOptions:this.getFormOptions}},data(){return{editModal:$,deviceColumns:[{name:"name",label:this.$t("Tunnel name")},{name:"hub_address",label:this.$t("Hub address")},{name:"config_mode",label:this.$t("Configuration mode")},{name:"enabled"}],formOptions:{interfaces:[],gre:[]}}},methods:{getFormOptions(){return this.formOptions},loadMode(n){return n.charAt(0).toUpperCase()+n.slice(1)},loadData(){const n=["/api/gre/config","/api/interfaces/config"];return this.$axios.bulkGet(n).then(([e,t])=>{e.success||this.$message.error(this.$t("Failed to load gre data")),t.success||this.$message.error(this.$t("Failed to load interface data")),this.formOptions.interfaces=t.success?t.data:[],this.formOptions.gre=e.success?e.data:[]}).catch(()=>{this.$message.error(this.$t("An unexpected error occurred"))})},validatePsk(n){!n.pre_shared_key&&n.enabled==="1"&&(n.enabled="0",this.$message.error(this.$t("Missing required option: Pre-shared key")))}}};var v=function(){var e=this,t=e._self._c;return t("vuci-form",{attrs:{config:"dmvpn;nhrp;network;firewall;ipsec","after-load":e.loadData},scopedSlots:e._u([{key:"default",fn:function({uciData:r}){return[t("vuci-typed-section",{attrs:{type:"dmvpn",title:e.$t("DMVPN Configuration"),columns:e.deviceColumns,"edit-form":e.editModal,"uci-data":r,endpoints:[{endpoint:"dmvpn/config"}],"data-key":"dmvpn","exception-options":["pre_shared_key"]},scopedSlots:e._u([{key:"name",fn:function({s:o}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":o,name:"id"}})]}},{key:"hub_address",fn:function({s:o}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":o,name:"hub_address"}})]}},{key:"config_mode",fn:function({s:o}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":o,name:"config_mode","display-value":e.loadMode}})]}},{key:"enabled",fn:function({s:o}){return[t("vuci-form-item-switch",{attrs:{"uci-section":o,name:"enabled"},on:{change:function(i){return e.validatePsk(o)}}})]}},{key:"addForm",fn:function({addModel:o}){return[t("tlt-form-item-input",{attrs:{label:e.$t("New configuration name"),prop:"id",required:"",help:e.$t("Name of the new DMVPN configuration. Used for easier configurations management purpose only"),rules:"uciname",maxlength:"8"},model:{value:o.id,callback:function(i){e.$set(o,"id",i)},expression:"addModel.id"}})]}}],null,!0)})]}}])})},b=[],y=l(_,v,b,!1,null,null,null,null);return y.exports});
