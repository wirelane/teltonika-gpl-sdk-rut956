(function(o,h){typeof exports=="object"&&typeof module<"u"?module.exports=h():typeof define=="function"&&define.amd?define(h):(o=typeof globalThis<"u"?globalThis:o||self,o["services/SpeedTest_js"]=h())})(this,function(){"use strict";function o(s,t,e,a,n,d,u,x){var i=typeof s=="function"?s.options:s;t&&(i.render=t,i.staticRenderFns=e,i._compiled=!0),a&&(i.functional=!0),d&&(i._scopeId="data-v-"+d);var l;if(u?(l=function(r){r=r||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!r&&typeof __VUE_SSR_CONTEXT__<"u"&&(r=__VUE_SSR_CONTEXT__),n&&n.call(this,r),r&&r._registeredComponents&&r._registeredComponents.add(u)},i._ssrRegister=l):n&&(l=x?function(){n.call(this,(i.functional?this.parent:this).$root.$options.shadowRoot)}:n),l)if(i.functional){i._injectStyles=l;var g=i.render;i.render=function(S,v){return l.call(v),g(S,v)}}else{var c=i.beforeCreate;i.beforeCreate=c?[].concat(c,l):[l]}return{exports:s,options:i}}const h={data(){return{searchValue:"",vueCanvas:null,vueCtx:null,startingPos:.75*Math.PI,endPos:2.25*Math.PI,canvasNumbers:[0,5,10,50,100,250,500,750,1e3],avgDownload:0,avgUpload:0,finalAvgDownload:0,finalAvgUpload:0,servers:[],targetIP:"",target:0,currentState:"",currentValue:0,isDisabledButton:!1,modalOpen:!1,serverColumns:[{dataIndex:"country",title:this.$t("Country")},{dataIndex:"city",title:this.$t("City")},{dataIndex:"distance",title:this.$t("Distance")},{dataIndex:"name",title:this.$t("Name")}],currentData:{},host:"",url:"",myIp:"",wan:"",serversExist:!0,currentSpeedTestIndex:null,circles:[],mobileOperator:""}},timers:{loadResults:{time:1e3,repeat:!0}},computed:{serverList(){return this.servers.map(s=>({country:s.country,city:s.name,name:s.sponsor,host:s.host,url:s.url,distance:`${s.distance}km`}))},interfaceInfo(){return`${this.wan}${this.myIp?" - "+this.myIp:""}`},serverInfo(){return`${this.host}${this.targetIP?" - "+this.targetIP:""}`}},watch:{currentState(s){clearInterval(this.interval),this.currentSpeedTestIndex=null,this.circles=[],s==="TESTING_UPLOAD"?this.interval=setInterval(()=>{this.currentSpeedTestIndex<9?(this.currentSpeedTestIndex++,this.circles.push(this.currentSpeedTestIndex),this.currentSpeedTestIndex>3&&this.circles.shift(this.currentSpeedTestIndex-3)):(this.currentSpeedTestIndex=null,this.circles=[])},100):s==="TESTING_DOWNLOAD"&&(this.interval=setInterval(()=>{this.currentSpeedTestIndex>=1?(this.circles.unshift(this.currentSpeedTestIndex),this.currentSpeedTestIndex--,this.currentSpeedTestIndex<6&&this.circles.pop(this.currentSpeedTestIndex)):(this.currentSpeedTestIndex=9,this.circles=[])},100))}},created(){this.loadData()},mounted(){this.vueCanvas=document.getElementById("speed-test"),this.vueCtx=this.vueCanvas.getContext("2d"),this.draw()},methods:{draw(){const s=this.currentValue;this.vueCtx.clearRect(0,0,this.vueCanvas.width,this.vueCanvas.height);let t=0;const e=.1875;s>0&&(t=t+e*2/10*(s>=10?10:s)),s>10&&(t=t+e/40*(s>=50?40:s-10)),s>50&&(t=t+e/50*(s>=100?50:s-50)),s>100&&(t=t+e/150*(s>=250?150:s-100)),s>250&&(t=t+e*3/750*(s>=1e3?750:s-250));const a=Math.PI*t;this.vueCanvas.width="300",this.vueCanvas.height="300",this.drawGaugeSpeeds(),this.drawGauge(this.endPos),this.drawGauge(Math.PI*.75+a,!0),this.drawCircle4(),this.drawCircle3(),this.drawCircle2(),this.drawCircle1withStroke(),this.drawPointerCircle(),this.drawPointer(a),this.drawSpeed(this.target),Math.round(this.target*10)!==Math.round(this.currentValue*10)&&(this.currentValue+=this.inclineCalculation(this.target,s),this.currentValue<.1&&(this.currentValue=0),window.requestAnimationFrame(this.draw))},drawGauge(s,t=!1){if(this.vueCtx.lineWidth=20,t){const e=this.vueCtx.createLinearGradient(this.vueCanvas.width/2,this.vueCanvas.height/2,50,200);(this.currentState==="TESTING_DOWNLOAD"||this.currentState==="COOLDOWN")&&(e.addColorStop("0","#0066CC"),e.addColorStop("0.5","#023D78")),(this.currentState==="TESTING_UPLOAD"||this.currentState==="FINISHED")&&(e.addColorStop("0","#FBB90F"),e.addColorStop("0.5","#E5670B")),this.vueCtx.strokeStyle=e}else this.vueCtx.strokeStyle="#E9E9E9";this.vueCtx.beginPath(),this.vueCtx.arc(this.vueCanvas.width/2,this.vueCanvas.height/2,102,this.startingPos,s),this.vueCtx.stroke()},drawPointer(s){s=Math.PI*1.75-s,this.vueCtx.beginPath(),this.vueCtx.globalAlpha=1;const t=this.getCoordinates(s,this.vueCanvas.width/2-this.vueCanvas.width/2*.26),e=this.getCoordinates(s+1.5*Math.PI,this.vueCanvas.width*.015),a=this.getCoordinates(s-1.5*Math.PI,this.vueCanvas.width*.015);this.vueCtx.moveTo(e[0],e[1]),this.vueCtx.lineTo(t[0],t[1]),this.vueCtx.lineTo(a[0],a[1]);const n=this.vueCtx.createLinearGradient(t[0],t[1],this.vueCanvas.width/2,this.vueCanvas.height);n.addColorStop(1,"#1F1E1E"),this.vueCtx.fillStyle=n,this.vueCtx.fill()},drawGaugeSpeeds(){for(let s=0;s<this.canvasNumbers.length;s++){const t=Math.PI*1.5*s/(this.canvasNumbers.length-1)-Math.PI*1.75,e=this.getCoordinates(-t,this.vueCanvas.height/2*.9);this.vueCtx.textAlign="center",this.vueCtx.font="600 14px Arial",this.currentState==="TESTING_DOWNLOAD"&&this.target>=this.canvasNumbers[s]?this.vueCtx.fillStyle="#023D78":this.currentState==="TESTING_UPLOAD"&&this.target>=this.canvasNumbers[s]?this.vueCtx.fillStyle="#E5670B":(this.vueCtx.fillStyle="#000000",this.vueCtx.font="14px Arial"),this.vueCtx.fillText(this.canvasNumbers[s],e[0],e[1])}},drawSpeed(s){this.vueCtx.fillStyle="#000000",this.vueCtx.font="32px Arial",this.vueCtx.textAlign="center",this.vueCtx.fillText(s>0?Math.round(s*100)/100:"-",this.vueCanvas.width/2,this.vueCanvas.height-30)},drawCircle1withStroke(){this.vueCtx.beginPath(),this.vueCtx.arc(this.vueCanvas.width/2,this.vueCanvas.height/2,17.5,0,2*Math.PI),this.vueCtx.fillStyle="#E9E9E9",this.vueCtx.lineWidth=1,this.vueCtx.fill(),this.vueCtx.strokeStyle="#DADADA",this.vueCtx.stroke(),this.vueCtx.strokeStyle="black"},drawCircle2(){this.vueCtx.beginPath(),this.vueCtx.arc(this.vueCanvas.width/2,this.vueCanvas.height/2,35,0,2*Math.PI),this.vueCtx.lineWidth=1,this.vueCtx.fillStyle="#FAFAFA",this.vueCtx.fill(),this.vueCtx.strokeStyle="#E9E9E9",this.vueCtx.stroke()},drawCircle3(){this.vueCtx.beginPath(),this.vueCtx.arc(this.vueCanvas.width/2,this.vueCanvas.height/2,53,0,2*Math.PI),this.vueCtx.lineWidth=1,this.vueCtx.fillStyle="#FAFAFA",this.vueCtx.fill(),this.vueCtx.strokeStyle="#E9E9E9",this.vueCtx.stroke()},drawCircle4(){this.vueCtx.beginPath(),this.vueCtx.arc(this.vueCanvas.width/2,this.vueCanvas.height/2,72.5,0,2*Math.PI),this.vueCtx.lineWidth=1,this.vueCtx.fillStyle="#FAFAFA",this.vueCtx.fill(),this.vueCtx.strokeStyle="#E9E9E9",this.vueCtx.stroke()},drawPointerCircle(){this.vueCtx.beginPath(),this.vueCtx.arc(this.vueCanvas.width/2,this.vueCanvas.height/2,7.5,0,2*Math.PI),this.vueCtx.strokeStyle="#1F1E1E",this.vueCtx.stroke(),this.vueCtx.fillStyle="#1F1E1E",this.vueCtx.fill()},inclineCalculation(s,t){const e=s-t;if(Math.abs(e)>.1)return e/10;if(e>0)return .01;if(e<0)return-.01},getCoordinates(s,t){return[this.vueCanvas.width/2+t*Math.sin(s),this.vueCanvas.height/2+t*Math.cos(s)]},startSpeedTest(){this.$prompt({title:this.$t("Run speed test?"),content:this.$t("Speed tests can drain a significant amount of data. Please make according considerations before using the speed test tool."),okText:this.$t("Continue"),cancelText:this.$t("Cancel"),onOk:this.onOk})},onOk(){return this.isDisabledButton=!0,this.avgDownload=0,this.avgUpload=0,this.finalAvgDownload=0,this.finalAvgUpload=0,this.$axios.post("/api/speedtest/actions/start",{data:{url:this.url}}).then(()=>{this.$timer.start("loadResults")})},loadResults(){return this.$axios.get("/api/speedtest/status?exclude=isp,external_ip").then(({success:s,data:t})=>{if(this.currentState=t.state,(!s||t.state==="ERROR")&&this.$timer.stop("loadResults"),this.currentState==="FINISHED"){this.target=0,this.finalAvgUpload=this.avgUpload,this.draw(),this.isDisabledButton=!1,this.$timer.stop("loadResults");return}this.currentState==="ERROR"?(this.target=0,this.$alert.error(this.$t(t.error)),this.host=this.$t("Failed to find provider"),this.targetIP=this.$t("Failed to find IP"),this.isDisabledButton=!1):this.currentState==="COOLDOWN"?(this.target=0,this.finalAvgDownload=this.avgDownload):this.currentState==="TESTING_DOWNLOAD"&&this.avgDownload!==this.convertToMbps(t.avgDownloadSpeed)?(this.avgDownload=this.convertToMbps(t.avgDownloadSpeed),this.target=this.avgDownload):this.currentState==="TESTING_UPLOAD"&&this.avgUpload!==this.convertToMbps(t.avgUploadSpeed)&&(this.avgUpload=this.convertToMbps(t.avgUploadSpeed),this.target=this.avgUpload),this.draw()})},loadIP(s){return this.$axios.post("/api/speedtest/actions/get_ip",{data:{url:s}}).then(t=>{this.targetIP=t.data.response}).catch(()=>{this.targetIP="",this.$alert.error(this.$t("Failed to retrieve provider IP address. Please check your internet connection."))})},getSelected(s){return this.currentData=s,this.closeModal(),this.url=this.currentData.url,this.host=this.currentData.name,this.isDisabledButton=!0,this.loadIP(this.currentData.host).then(()=>{this.isDisabledButton=!1})},loadData(){const s=["/api/speedtest/options","/api/speedtest/status"];return this.$axios.bulkGet(s).then(([t,e])=>{t.success?(this.servers=t.data,this.host=this.servers[0].sponsor,this.targetIP=this.servers[0].ip??""):(this.servers=[],this.$alert.error(this.$t("Cannot retrieve server list."))),e.success?(this.wan=e.data.wan_name,this.mobileOperator=e.data.isp,this.myIp=e.data.wan_ip):this.$alert.error(this.$t("Failed to retrieve wan. Please check your internet connection."))}).catch(()=>{this.$timer.stop("loadResults"),this.$message.error("An unexpected error occurred")})},refreshServerList(){return this.$axios.post("/api/speedtest/actions/refresh").then(s=>{this.servers=s.success?s.data:[]}).catch(()=>{this.$alert.error(this.$t("Cannot retrieve server list.")),this.serversExist=!1})},convertToMbps(s){return s/125e3},openModal(){this.modalOpen=!0,this.isDisabledButton=!0},closeModal(){this.$refs.serversModal.closeModal(),this.modalOpen=!1,this.isDisabledButton=!1}}};var f=function(){var t=this,e=t._self._c;return e("tlt-card",{attrs:{title:t.$t("Speed Test")}},[e("div",{staticClass:"xl:mt-14 flex flex-col xl:flex-row justify-center"},[e("div",{staticClass:"flex flex-row xl:flex-col",attrs:{"test-id":"speed-label-wrapper"}},[e("div",{staticClass:"flex w-full items-center mr-2 xl:mr-0 p-4 xl:w-[282px] h-20 rounded-xl border mb-8 xl:mb-[84px]",attrs:{"test-id":"speed-label"}},[e("div",{staticClass:"bg-primary-300 rounded-full mr-4 p-1"},[e("tlt-icon",{staticClass:"text-white",attrs:{icon:"download",size:"w-6 h-6"}})],1),e("div",[e("h2",{staticClass:"text-gray-tlt-100 font-semibold text-body-secondary mb-2"},[t._v(" "+t._s(t.$t("Download"))+" ")]),t.currentState==="TESTING_DOWNLOAD"?e("p",[t._v(" "+t._s(t.$t("Testing..."))+" ")]):e("p",[t._v(" "+t._s(t.finalAvgDownload>0?t.finalAvgDownload.toFixed(2)+" "+t.$t("Mbps"):"-")+" ")])])]),e("div",{staticClass:"flex w-full items-center p-4 xl:w-[282px] h-20 rounded-xl border",attrs:{"test-id":"speed-label"}},[e("div",{staticClass:"bg-orange-600 rounded-full p-1 mr-4"},[e("tlt-icon",{staticClass:"text-white",attrs:{icon:"upload",size:"w-6 h-6"}})],1),e("div",[e("h2",{staticClass:"text-gray-tlt-100 font-semibold text-body-secondary mb-2"},[t._v(" "+t._s(t.$t("Upload"))+" ")]),t.currentState==="TESTING_UPLOAD"?e("p",[t._v(" "+t._s(t.$t("Testing..."))+" ")]):e("p",[t._v(" "+t._s(t.finalAvgUpload>0?t.finalAvgUpload.toFixed(2)+" "+t.$t("Mbps"):"-")+" ")])])])]),e("div",[e("div",{staticClass:"mx-6 2xl:mx-20 flex justify-center items-center"},[e("canvas",{attrs:{id:"speed-test"}},[t._v(" "+t._s(t.$t("Your browser does not support the canvas element."))+" ")])]),e("div",{staticClass:"flex flex-col items-center mb-10 gap-5",attrs:{"test-id":"provider-wrapper"}},[e("div",{staticClass:"flex items-center justify-center gap-2"},[e("tlt-icon",{staticClass:"text-gray-600",attrs:{icon:"upload",size:"w-4 h-4"}}),e("span",[t._v(t._s(t.$t("Mbps")))])],1),e("div",[e("strong",[t._v(t._s(t.$t("Carrier"))+":")]),t._v(" "+t._s(t.mobileOperator)+" ")]),e("tlt-button",{attrs:{"button-id":"starttest",disabled:t.isDisabledButton},on:{click:t.startSpeedTest}},[t._v(" "+t._s(t.$t("Start Test"))+" ")])],1)]),e("div",{staticClass:"flex flex-col"},[e("div",{staticClass:"flex w-full items-center mb-2 xl:mb-0 p-4 xl:w-[282px] h-20 rounded-xl border"},[e("tlt-icon",{staticClass:"h-8 w-8 mr-4 bg-gray-tlt-100 p-1 rounded-full text-white shrink-0",attrs:{icon:"device"}}),e("div",{staticClass:"w-[200px]"},[e("h2",{staticClass:"text-gray-tlt-100 font-semibold text-body-secondary mb-2"},[t._v(" "+t._s(t.$t("Interface"))+" ")]),t.interfaceInfo.length>=35?e("tlt-hint",{staticClass:"w-[200px]",attrs:{hints:[{info:t.interfaceInfo}]}},[e("p",{staticClass:"truncate"},[t._v(" "+t._s(t.interfaceInfo?t.interfaceInfo:t.$t("Searching for Interface information"))+" ")])]):e("p",{staticClass:"truncate"},[t._v(" "+t._s(t.interfaceInfo?t.interfaceInfo:t.$t("Searching for Interface information"))+" ")])],1)],1),e("div",{staticClass:"hidden xl:flex flex-col justify-center items-center py-2"},t._l(9,function(a){return e("div",{key:a,staticClass:"w-1 h-1 mb-1 bg-gray-tlt-400 rounded-full last:mb-0",class:{"bg-primary-100":t.currentState==="TESTING_DOWNLOAD"&&t.circles.includes(a),"bg-orange-500":t.currentState==="TESTING_UPLOAD"&&t.circles.includes(a)}})}),0),e("div",{staticClass:"w-full flex items-center p-4 xl:w-[282px] h-20 rounded-xl border"},[e("tlt-icon",{staticClass:"h-8 w-8 mr-4 bg-gray-tlt-100 p-1 rounded-full text-white stroke-gray-tlt-100 shrink-0",attrs:{icon:"server"}}),e("div",[e("div",{staticClass:"flex items-center text-body-secondary mb-2 font-semibold"},[e("h2",{staticClass:"text-gray-tlt-100 mr-2"},[t._v(" "+t._s(t.$t("Server"))+" ")]),e("tlt-button",{attrs:{type:"text","button-id":"changeserver",disabled:t.isDisabledButton},on:{click:t.openModal}},[t._v(" "+t._s(t.$t("Change"))+" ")])],1),t.serverInfo.length>=35?e("tlt-hint",{staticClass:"w-[200px]",attrs:{hints:[{info:t.serverInfo}]}},[e("p",{staticClass:"truncate block"},[t._v(" "+t._s(t.serverInfo?t.serverInfo:t.$t("Searching for Server information"))+" ")])]):e("p",{staticClass:"truncate block"},[t._v(" "+t._s(t.serverInfo?t.serverInfo:t.$t("Searching for Server information"))+" ")])],1)],1)])]),t.modalOpen?e("tlt-modal",{ref:"serversModal",attrs:{visible:t.modalOpen,big:""},on:{close:t.closeModal}},[e("tlt-form",{attrs:{sid:"tlt-form-speedtest-servers"}},[e("tlt-card",{attrs:{title:t.$t("Speed Test Server list")},scopedSlots:t._u([{key:"title-content",fn:function(){return[e("div",{staticClass:"ml-auto"},[e("tlt-input-search",{model:{value:t.searchValue,callback:function(a){t.searchValue=a},expression:"searchValue"}})],1)]},proxy:!0}],null,!1,3927883235)},[e("tlt-table",{attrs:{id:"servers",columns:t.serverColumns,"data-source":t.serverList,"no-value-text":t.serversExist?t.$t("This section does not contain any servers yet"):t.$t("Cannot retrieve any servers. Please check your internet connection"),search:t.searchValue,pagination:"",selectable:""},on:{selected:t.getSelected}}),e("tlt-button",{staticClass:"my-4",attrs:{"button-id":"refresh"},on:{click:t.refreshServerList}},[t._v(" "+t._s(t.$t("Refresh"))+" ")])],1)],1)],1):t._e()],1)},p=[],C=o(h,f,p,!1,null,null,null,null);return C.exports});
