(function(l,c){typeof exports=="object"&&typeof module<"u"?module.exports=c():typeof define=="function"&&define.amd?define(c):(l=typeof globalThis<"u"?globalThis:l||self,l["services/WebfilterSite_js"]=c())})(this,function(){"use strict";function l(e,t,i,r,o,d,h,$){var s=typeof e=="function"?e.options:e;t&&(s.render=t,s.staticRenderFns=i,s._compiled=!0),r&&(s.functional=!0),d&&(s._scopeId="data-v-"+d);var n;if(h?(n=function(a){a=a||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!a&&typeof __VUE_SSR_CONTEXT__<"u"&&(a=__VUE_SSR_CONTEXT__),o&&o.call(this,a),a&&a._registeredComponents&&a._registeredComponents.add(h)},s._ssrRegister=n):o&&(n=$?function(){o.call(this,(s.functional?this.parent:this).$root.$options.shadowRoot)}:o),n)if(s.functional){s._injectStyles=n;var k=s.render;s.render=function(v,u){return n.call(u),k(v,u)}}else{var f=s.beforeCreate;s.beforeCreate=f?[].concat(f,n):[n]}return{exports:e,options:s}}const c={data(){return{listOptions:[["whitelist",this.$t("Whitelist")],["blacklist",this.$t("Blacklist")]],siteColumns:[{name:"host",label:this.$t("Hostname")},{name:"enabled",label:this.$t("")}],formData:{},uploadErrors:{1:this.$t("Error while uploading the file"),103:this.$t("Domain names with an optional wildcard (*) at the start are accepted. E.g. example.com or *.example.com"),150:this.$t("Maximum upload file size reached"),default:this.$t("Failed to upload host list")},coovaChilli:this.$store.getters.hasPackages("coova-chilli"),networkOptions:[],hotspotInterface:{},enabledHotspot:!1}},computed:{filteredNetworkOptions(){const e=this.networkOptions.filter(t=>t.area_type==="lan"&&t.id!=="lan").map(this.$network.getName);return this.hotspotInterface&&e.push(["hotspot",this.$t("Hotspot")]),e.unshift(["all",this.$t("All LAN interfaces")]),e}},created(){this.$alert.info(this.$t("Be careful not to block Yourself when using VPN or other services!"))},methods:{handleError(e){return e.data.errors[0].error},afterAdd(){const e=Number(this.$refs.table.$refs["tlt-table"].perPage),t=(this.formData.block.length+1)/e;this.$nextTick(()=>this.$refs.table.$refs["tlt-table"]._setCurrentPage(Math.ceil(t)))},onUpload({res:e}){this.formData.block=[...this.formData.block,...e.data],this.$message.success(this.$t("The host list was uploaded successfully"))},validateHostname(e){const t=/^\*(\..*)/;return e=e.replace(t,"a$1"),this.$VuciValidator.value=e,this.$VuciValidator.hostname().isValid?{isValid:!0}:{isValid:!1,message:this.$t("Domain names with an optional wildcard (*) at the start are accepted. E.g. example.com or *.example.com .")}},validateHotspot(e){return e!=="hotspot"||e==="hotspot"&&this.enabledHotspot?{isValid:!0}:(this.$message.error(this.$t("Hotspot instance must be enabled")),{isValid:!1,message:this.$t("Hotspot instance must be enabled")})},validateWildCard(e){return/.+\*.*/.test(e)?{isValid:!1,message:this.$t("Wildcard (*) can only be located at the start of the hostname.")}:{isValid:!0}},afterLoad(){const e=[{endpoint:"/api/hotspot/status",condition:this.coovaChilli},"/api/interfaces/config"];return this.$axios.bulkGet(e).then(([t,i])=>{t.success||this.$message.error(this.$t("Failed to load hotspot data")),i.success||this.$message.error(this.$t("Failed to load network data")),this.networkOptions=i.data,this.hotspotInterface=t.data,this.enabledHotspot=this.hotspotInterface.enabled!=="0"}).catch(()=>{this.$message.error(this.$t("An unexpected error occurred"))})}}};var p=function(){var t=this,i=t._self._c;return i("vuci-form",{attrs:{"after-load":t.afterLoad,config:"hostblock"},scopedSlots:t._u([{key:"default",fn:function({uciData:r}){return[i("vuci-named-section",{attrs:{name:"general",title:t.$t("Site Blocking Settings"),help:t.$t("The site blocking service provides you with the possibility to create a Blacklist or Whitelist that filters out which websites users on the local network can access."),"uci-data":r,"data-key":"config",endpoints:[{endpoint:"webfilter/global"}]},scopedSlots:t._u([{key:"default",fn:function({s:o}){return[i("vuci-form-item-switch",{attrs:{"uci-section":o,name:"enabled",label:t.$t("Enable"),help:t.$t("Turns site blocking on or off.")}}),i("vuci-form-item-select",{attrs:{"uci-section":o,label:t.$t("Mode"),help:t.$t("Mode of operation %s       Whitelist - allow every site included in the list and block everything else %s       Blacklist - block every site included in the list and allow everything else.").format("<br>","<br>"),name:"mode",options:t.listOptions,initial:"blacklist",rawhtml:""}}),i("vuci-form-item-select",{attrs:{"uci-section":o,name:"network",label:t.$t("Network"),help:t.$t("Network for which the site blocking service is activated."),options:t.filteredNetworkOptions,placeholder:t.$t("-- Please select --"),rules:t.validateHotspot}}),i("tlt-form-model-item",{attrs:{label:t.$t("Host list"),help:t.$t("Upload a file with many hosts, one hostname per file line (max file size allowed is 3KB)")}},[i("tlt-upload",{attrs:{name:"host",action:"/api/webfilter/config","max-size":3072,instant:"",errors:t.uploadErrors},on:{uploaded:t.onUpload}})],1)]}}],null,!0)}),i("vuci-typed-section",{ref:"table",attrs:{"uci-data":r,endpoints:[{endpoint:"webfilter/config"}],"data-key":"block",type:"block",title:t.$t("Site Blocking Rules"),help:t.$t("Configuration for individual websites"),columns:t.siteColumns,expanded:"",addremove:"",pagination:"",search:"","after-add":t.afterAdd,"error-handlers":{create:t.handleError}},scopedSlots:t._u([{key:"host",fn:function({s:o}){return[i("vuci-form-item-input",{attrs:{"uci-section":o,name:"host",rules:[t.validateWildCard,t.validateHostname],placeholder:"myhost.example.com"}})]}},{key:"enabled",fn:function({s:o}){return[i("vuci-form-item-switch",{attrs:{"uci-section":o,name:"enabled"}})]}}],null,!0)})]}}]),model:{value:t.formData,callback:function(r){t.formData=r},expression:"formData"}})},m=[],b=l(c,p,m,!1,null,null,null,null);return b.exports});
