(function(l,c){typeof exports=="object"&&typeof module<"u"?module.exports=c():typeof define=="function"&&define.amd?define(c):(l=typeof globalThis<"u"?globalThis:l||self,l["services/MqttPub_js"]=c())})(this,function(){"use strict";function l(s,e,i,a,t,d,p,$){var r=typeof s=="function"?s.options:s;e&&(r.render=e,r.staticRenderFns=i,r._compiled=!0),a&&(r.functional=!0),d&&(r._scopeId="data-v-"+d);var n;if(p?(n=function(o){o=o||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!o&&typeof __VUE_SSR_CONTEXT__<"u"&&(o=__VUE_SSR_CONTEXT__),t&&t.call(this,o),o&&o._registeredComponents&&o._registeredComponents.add(p)},r._ssrRegister=n):t&&(n=$?function(){t.call(this,(r.functional?this.parent:this).$root.$options.shadowRoot)}:t),n)if(r.functional){r._injectStyles=n;var b=r.render;r.render=function(v,u){return n.call(u),b(v,u)}}else{var f=r.beforeCreate;r.beforeCreate=f?[].concat(f,n):[n]}return{exports:s,options:r}}const c={data(){return{modems:[],formData:{},formOptions:{certificates:[]},sectionHint:this.$t("An MQTT Publisher is a client that sends messages to the Broker, who then forwards these messages to the Subscriber."),tlsTypes:[["cert",this.$t("Certificate based")],["psk",this.$t("Pre-Shared-Key based")]],deviceFilesHint:`${this.$t("Choose this option if you want to select certificate files from device.")}<br>
      ${this.$t("Certificate files can be generated")} <a class=link href="/system/admin/certificates/generation">${this.$t("here")}</a>`,isPasswordSet:!1,isPskSet:!1,passSetPlaceholder:this.$t("Password is set"),pskSetPlaceholder:this.$t("Pre-Shared-Key is set")}},computed:{caOptions(){return this.formOptions.certificates.filter(e=>(e.cert_type==="ca"||e.cert_type==="import"||e.cert_type==="root_ca")&&e.type==="cert").map(e=>e.cert_type!=="root_ca"?["/etc/certificates/"+e.fullname,e.fullname]:["/etc/ssl/certs/"+e.fullname,e.fullname])},certOptions(){const e=this.formOptions.certificates.filter(i=>i.type==="cert").map(i=>i.cert_type!=="root_ca"?["/etc/certificates/"+i.fullname,i.fullname]:["/etc/ssl/certs/"+i.fullname,i.fullname]);return e.length>0&&e.unshift(["",this.$t("None")]),e},keyOptions(){const e=this.formOptions.certificates.filter(i=>i.type==="key").map(i=>["/etc/certificates/"+i.fullname,i.fullname]);return e.length>0&&e.unshift(["",this.$t("None")]),e},modemOptions(){return this.$mobile.modemsOptions(this.modems)}},methods:{afterLoad(s){const e=["/api/certificates/config",{endpoint:"/api/modems/status",condition:"mobifd.control"}];return this.$axios.bulkGet(e).then(([i,a])=>(i.success||this.$message.error(this.$t("Failed to load certificate data")),a.success||this.$message.error(this.$t("Failed to load modem options")),this.formOptions.certificates=i.success?i.data.generated:[],this.modems=a.success?this.$mobile.parseModems(a.data):[],this.isPasswordSet=s.mqtt[0].password==="set",this.isPskSet=s.mqtt[0].psk==="set",s.mqtt[0].password="",s.mqtt[0].psk="",s)).catch(()=>{this.$message.error(this.$t("An unexpected error occurred"))})},onAfterSave(s,e){this.isPasswordSet=e.data.password==="set",this.isPskSet=e.data.psk==="set",e.data.password="",e.data.psk="",this.$set(e.data,"require_password",this.isPasswordSet?"1":"0")},validatePrefix(s){return s.match(/^[^#+]+$/)?{isValid:!0}:{isValid:!1,message:this.$t('Values with "#" or "+" are not accepted.')}}}};var m=function(){var e=this,i=e._self._c;return i("vuci-form",{attrs:{config:"mqtt_pub","after-load":e.afterLoad},scopedSlots:e._u([{key:"default",fn:function({uciData:a}){return[i("vuci-named-section",{attrs:{name:"mqtt_pub",title:e.$t("MQTT Publisher"),help:e.sectionHint,"uci-data":a,"data-key":"mqtt",endpoints:[{endpoint:"mqtt/publisher/config"}],"after-save":e.onAfterSave},scopedSlots:e._u([{key:"default",fn:function({s:t}){return[i("vuci-form-item-switch",{attrs:{name:"enabled",label:e.$t("Enable"),help:e.$t("Select to enable MQTT publisher"),"uci-section":t}}),i("vuci-form-item-input",{attrs:{name:"remote_addr",label:e.$t("Hostname"),help:e.$t("Specify address of the broker"),placeholder:"www.example.com",rules:"host",required:t.enabled==="1","uci-section":t}}),i("vuci-form-item-input",{attrs:{name:"remote_port",label:e.$t("Port"),help:e.$t("Specify port of the broker"),placeholder:"1883",rules:"port",initial:"1883",required:t.enabled==="1","uci-section":t}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"client_id",label:e.$t("Client ID"),help:e.$t("Client ID to send with the data. If empty, a random client ID will be generated"),placeholder:e.$t("Client ID"),rules:"fieldvalidation('^[a-zA-Z0-9!@#:%$%%&%*%+%-/=%?%^_`%[%]{|}~%.]+$')",maxlength:"64"}}),i("vuci-form-item-select",{attrs:{"uci-section":t,name:"modem_id",label:e.$t("Modem"),help:e.$t("Select which modem to use when getting information"),options:e.modemOptions,depend:e.modemOptions.length>1}}),i("vuci-form-item-input",{attrs:{name:"username",label:e.$t("Username"),help:e.$t("Specify username of remote host"),"uci-section":t,rules:"credentials_validate",maxlength:"512"}}),i("vuci-form-item-switch",{attrs:{name:"require_password","uci-section":t,label:e.$t("Require password"),initial:e.isPasswordSet?"1":"0","no-write":""}}),i("vuci-form-item-input",{attrs:{name:"password",label:e.$t("Password"),help:e.$t("Specify password of remote host. Allowed characters (a-zA-Z0-9!@#$%&*+-/=?^_`{|}~. )"),"uci-section":t,rules:"credentials_validate",maxlength:"512",password:"",depend:t.require_password==="1","no-write":t.password===""&&t.require_password==="1",required:!e.isPasswordSet&&t.require_password==="1",placeholder:e.isPasswordSet?e.passSetPlaceholder:""}}),i("vuci-form-item-switch",{attrs:{name:"tls",label:e.$t("TLS"),"uci-section":t,help:e.$t("Select to enable TLS encryption")}}),i("vuci-form-item-select",{attrs:{name:"tls_type",label:e.$t("TLS Type"),help:e.$t("Select the type of TLS encryption"),"uci-section":t,options:e.tlsTypes,depend:t.tls==="1"}}),i("vuci-form-item-switch",{attrs:{name:"tls_insecure",label:e.$t("Allow insecure connection"),help:e.$t("Allow not verifying server authenticity"),"uci-section":t,depend:t.tls_type==="cert"&&t.tls==="1"}}),i("vuci-form-item-switch",{attrs:{name:"device_files",label:e.$t("Certificate files from device"),help:e.deviceFilesHint,"uci-section":t,depend:t.tls_type==="cert"&&t.tls==="1",rawhtml:""}}),i("vuci-form-item-upload",{attrs:{name:"cafile",label:e.$t("CA file"),help:e.$t("Upload CA file"),"uci-section":t,depend:t.tls_type==="cert"&&t.tls==="1"&&(t.device_files==="0"||!t.device_files),required:t.enabled==="1"&&t.tls_type==="cert"&&t.tls==="1","max-size":"16MB"}}),i("vuci-form-item-upload",{attrs:{name:"certfile",label:e.$t("Certificate file"),help:e.$t("Upload Certificate file"),"uci-section":t,depend:t.tls_type==="cert"&&t.tls==="1"&&(t.device_files==="0"||!t.device_files),"max-size":"16MB"}}),i("vuci-form-item-upload",{attrs:{name:"keyfile",label:e.$t("Key file"),help:e.$t("Upload Key file"),"uci-section":t,depend:t.tls_type==="cert"&&t.tls==="1"&&(t.device_files==="0"||!t.device_files),"max-size":"16MB"}}),i("vuci-form-item-select",{attrs:{name:"cafile",label:e.$t("CA file"),help:e.$t("Select CA file"),options:e.caOptions,"uci-section":t,depend:t.tls_type==="cert"&&t.tls==="1"&&t.device_files==="1",required:t.enabled==="1"&&t.tls_type==="cert"&&t.tls==="1"}}),i("vuci-form-item-select",{attrs:{name:"certfile",label:e.$t("Certificate file"),help:e.$t("Select Certificate file"),"uci-section":t,depend:t.tls_type==="cert"&&t.tls==="1"&&t.device_files==="1",options:e.certOptions}}),i("vuci-form-item-select",{attrs:{name:"keyfile",label:e.$t("Key file"),help:e.$t("Select Key file"),options:e.keyOptions,"uci-section":t,depend:t.tls_type==="cert"&&t.tls==="1"&&t.device_files==="1"}}),i("vuci-form-item-input",{attrs:{name:"psk",label:e.$t("Pre-Shared-Key"),help:e.$t("The pre-shared-key in hex format with no leading “0x”"),"uci-section":t,maxlength:"128",rules:"hexstring",depend:t.tls_type==="psk"&&t.tls==="1",required:!e.isPskSet&&t.enabled==="1","no-write":t.psk===""&&t.tls_type==="psk",placeholder:e.isPskSet?e.pskSetPlaceholder:""}}),i("vuci-form-item-input",{attrs:{name:"identity",label:e.$t("Identity"),help:e.$t("Specify the Identity"),placeholder:"Identity",maxlength:"128",rules:"uciname","uci-section":t,depend:t.tls_type==="psk"&&t.tls==="1",required:t.enabled==="1"}}),i("vuci-form-item-input",{attrs:{name:"pub_prefix",label:e.$t("Publish topic prefix"),help:e.$t("Prefix of the topic to be used during publish. %s More information %s").format("<a href='"+e.$brand("mqttWikiURL")+"'>","</a>"),"uci-section":t,rules:e.validatePrefix,rawhtml:""}}),i("vuci-form-item-input",{attrs:{name:"sub_prefix",label:e.$t("Subscribe topic prefix"),help:e.$t("Prefix of the topic to be used during subscription. %s More information %s").format("<a href='"+e.$brand("mqttWikiURL")+"'>","</a>"),"uci-section":t,rules:"string",rawhtml:""}})]}}],null,!0)})]}}]),model:{value:e.formData,callback:function(a){e.formData=a},expression:"formData"}})},h=[],_=l(c,m,h,!1,null,null,null,null);return _.exports});
