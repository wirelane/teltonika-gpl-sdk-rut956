(function(l,c){typeof exports=="object"&&typeof module<"u"?module.exports=c():typeof define=="function"&&define.amd?define(c):(l=typeof globalThis<"u"?globalThis:l||self,l["services/Bacnet_js"]=c())})(this,function(){"use strict";function l(i,e,a,o,t,d,u,v){var n=typeof i=="function"?i.options:i;e&&(n.render=e,n.staticRenderFns=a,n._compiled=!0),o&&(n.functional=!0),d&&(n._scopeId="data-v-"+d);var s;if(u?(s=function(r){r=r||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!r&&typeof __VUE_SSR_CONTEXT__<"u"&&(r=__VUE_SSR_CONTEXT__),t&&t.call(this,r),r&&r._registeredComponents&&r._registeredComponents.add(u)},n._ssrRegister=s):t&&(s=v?function(){t.call(this,(n.functional?this.parent:this).$root.$options.shadowRoot)}:t),s)if(n.functional){n._injectStyles=s;var _=n.render;n.render=function($,m){return s.call(m),_($,m)}}else{var f=n.beforeCreate;n.beforeCreate=f?[].concat(f,s):[s]}return{exports:i,options:n}}const c={data(){return{serial:[],devices:[],formData:{}}},computed:{serialOptions(){return this.$serial.filterOptions(this.serial,"/dev/rs485",{},"internal")},deviceOptions(){return this.devices.filter(i=>i.name&&i.name!=="lo"&&!i.name.includes("sit")&&i.up).map(i=>i.name)},usedDevice(){return this.status.find(i=>i.name==="/dev/rs485"&&i.is_used==="1")}},methods:{afterLoad(){return this.$axios.bulkGet(["/api/network/devices/status","/api/system/device/status","/api/serial/status"]).then(([i,e,a])=>{this.status=a.success?a.data:[],this.devices=i.success?i.data:[],this.serial=e.success&&e.data.board.serial?e.data.board.serial:[],a.success||this.$message.error(this.$t("Failed to load serial status")),i.success||this.$message.error(this.$t("Failed to load device data")),e.success||this.$message.error(this.$t("Failed to load serial device info"))}).catch(()=>{this.$message.error(this.$t("An unexpected error occurred"))})}}};var p=function(){var e=this,a=e._self._c;return a("vuci-form",{attrs:{config:"bacnet_router","after-load":e.afterLoad},scopedSlots:e._u([{key:"default",fn:function({uciData:o}){return[a("vuci-named-section",{attrs:{"uci-data":o,title:e.$t("General configuration"),name:"general",endpoints:[{endpoint:"bacnet/config"}],"data-key":"general"},scopedSlots:e._u([{key:"default",fn:function({s:t}){return[a("vuci-form-item-switch",{attrs:{"uci-section":t,label:e.$t("Enable"),name:"enabled",rawhtml:"",help:e.$t("Enables BACnet router function"),readonly:e.$serial.validateServices(e.status,{device:"/dev/rs485"},"BACnet")&&t.enabled==="0"}}),e.$serial.validateServices(e.status,{device:"/dev/rs485"},"BACnet")&&t.enabled==="0"?a("tlt-inline-message",{attrs:{id:"device-service-enabled",type:"warning"}},[e._v(" "+e._s(e.$t("Device is already enabled in %s service, disable it").format(e.usedDevice.service))+" "),a("router-link",{attrs:{to:e.$serial.returnPath(e.usedDevice.service),"test-id":"device-service-enabled-link"}},[e._v(" "+e._s(e.$t("here"))+" ")])],1):e._e(),a("vuci-form-item-switch",{attrs:{"uci-section":t,label:e.$t("Enable BBMD"),name:"bbmd_enabled",help:e.$t("Enables BACnet broadcast management function")}}),a("vuci-form-item-select",{attrs:{"uci-section":t,label:e.$t("BBMD interface"),name:"bbmd_interface",help:e.$t("Select interface for BBMD function. IP address of this interface should be reachable from WAN"),depend:t.bbmd_enabled==="1"&&t.force_gateway==="0",options:e.deviceOptions}}),a("vuci-form-item-switch",{attrs:{"uci-section":t,label:e.$t("Allow Remote Access"),name:"allow_ra",help:e.$t("Creates port forward firewall rule to make application port in LAN reachable from selected BBMD interface"),depend:t.bbmd_enabled==="1"}}),a("vuci-form-item-switch",{attrs:{"uci-section":t,label:e.$t("Force gateway"),name:"force_gateway",help:e.$t("Adds configured gateway IP address and port to bbmd packages sent"),depend:t.bbmd_enabled==="1"}}),a("vuci-form-item-input",{attrs:{"uci-section":t,label:e.$t("Gateway address"),help:e.$t("Gateway IP address"),name:"gateway_address",rules:"ip4addr",depend:t.bbmd_enabled==="1"&&t.force_gateway==="1",required:""}}),a("vuci-form-item-input",{attrs:{"uci-section":t,label:e.$t("Gateway port"),help:e.$t("Gateway port number"),name:"gateway_port",rules:"port",depend:t.bbmd_enabled==="1"&&t.force_gateway==="1",required:""}})]}}],null,!0)}),a("vuci-named-section",{attrs:{"uci-data":o,title:e.$t("BIP configuration"),name:"general",endpoints:[{endpoint:"bacnet/bip/config"}],"data-key":"bip"},scopedSlots:e._u([{key:"default",fn:function({s:t}){return[a("vuci-form-item-input",{attrs:{"uci-section":t,label:e.$t("BIP port"),help:e.$t("BIP UDP port"),name:"port",initial:"47808",rules:"port",required:""}})]}}],null,!0)}),a("vuci-named-section",{attrs:{"uci-data":o,title:e.$t("MSTP configuration"),name:"general",endpoints:[{endpoint:"bacnet/mstp/config"}],"data-key":"mstp"},scopedSlots:e._u([{key:"default",fn:function({s:t}){return[a("vuci-form-item-input",{attrs:{"uci-section":t,label:e.$t("MSTP MAC"),help:e.$t("Router MSTP MAC address"),name:"mac",rules:"range(0,127)",initial:"127",required:""}}),a("vuci-form-item-input",{attrs:{"uci-section":t,label:e.$t("MSTP MAC max"),help:e.$t("Maximum client address in the MSTP network"),name:"max_client",rules:"range(1,127)",initial:"127",required:""}}),a("vuci-form-item-select",{attrs:{"uci-section":t,label:e.$t("Baud rate"),name:"baud",help:e.$t("Select RS485 baud rate"),options:e.serialOptions.baudRate,initial:"38400"}}),a("vuci-form-item-select",{attrs:{"uci-section":t,label:e.$t("Parity"),name:"parity",help:e.$t("Select RS485 parity bit"),options:e.serialOptions.parity,initial:"None"}}),a("vuci-form-item-select",{attrs:{"uci-section":t,label:e.$t("Data bits"),name:"databits",help:e.$t("Select RS485 data bit count"),options:e.serialOptions.dataBits,initial:"8"}}),a("vuci-form-item-select",{attrs:{"uci-section":t,label:e.$t("Stop bits"),name:"stopbits",help:e.$t("RS485 data stop bit count"),options:e.serialOptions.stopBits,initial:"1"}})]}}],null,!0)})]}}]),model:{value:e.formData,callback:function(o){e.formData=o},expression:"formData"}})},b=[],h=l(c,p,b,!1,null,null,null,null);return h.exports});
