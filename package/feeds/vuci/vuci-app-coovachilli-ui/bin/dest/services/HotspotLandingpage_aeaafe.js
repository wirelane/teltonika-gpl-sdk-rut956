(function(u,d){typeof exports=="object"&&typeof module<"u"?module.exports=d():typeof define=="function"&&define.amd?define(d):(u=typeof globalThis<"u"?globalThis:u||self,u["services/HotspotLandingpage_js"]=d())})(this,function(){"use strict";function u(i,e,t,a,s,n,o,c){var l=typeof i=="function"?i.options:i;e&&(l.render=e,l.staticRenderFns=t,l._compiled=!0),a&&(l.functional=!0),n&&(l._scopeId="data-v-"+n);var r;if(o?(r=function(m){m=m||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!m&&typeof __VUE_SSR_CONTEXT__<"u"&&(m=__VUE_SSR_CONTEXT__),s&&s.call(this,m),m&&m._registeredComponents&&m._registeredComponents.add(o)},l._ssrRegister=r):s&&(r=c?function(){s.call(this,(l.functional?this.parent:this).$root.$options.shadowRoot)}:s),r)if(l.functional){l._injectStyles=r;var C=l.render;l.render=function(R,f){return r.call(f),C(R,f)}}else{var h=l.beforeCreate;l.beforeCreate=h?[].concat(h,r):[r]}return{exports:i,options:l}}const d={props:{theme:{type:String,required:!0},section:{type:Object,required:!0},resettable:{type:Boolean,required:!0}},data(){return{formData:{},title:`${this.section.file} ${this.$t("file")}`}},methods:{resetText(){return this.$prompt({title:this.$t("Reset template?"),content:this.$t("Are you sure you want to reset template?"),okText:this.$t("Reset"),cancelText:this.$t("Cancel"),onOk:()=>this.onOk()})},onOk(){this.$spin();const i={data:{file:this.section.file!=="landing_page.css"?this.section.file:"css.htm"}};return this.$axios.post(`/api/hotspot/themes/${this.theme}/actions/reset`,i).then(({data:e})=>{const t=this.formData[`${this.theme}-${this.section.file.slice(0,-4)}`];this.section.file!=="landing_page.css"?t[0].file=e.file:this.formData[`${this.theme}-css`][0].file=e.file,this.$message.success(this.$t("Template has been reset"))}).catch(()=>{this.$message.error(this.$t("Failed to reset template"))}).finally(()=>{this.$spin(!1)})},loadInitial(){const i=this.section.file!=="landing_page.css"?this.section.file.slice(0,-4):"css";return this.$axios.get(`/api/hotspot/themes/${this.theme}/config/${i}`).then(e=>{this.section.file!=="landing_page.css"?this.formData[`${this.theme}-${this.section.file.slice(0,-4)}`][0].file=e.data.file:this.formData[`${this.theme}-css`][0].file=e.data.file}).catch(()=>{this.$message.error(this.$t("An unexpected error occurred"))})},afterSave(i,e){e.data.name=this.section.file.slice(0,-4)}}};var p=function(){var e=this,t=e._self._c;return t("vuci-form",{attrs:{"after-load":e.loadInitial,config:"landingpage",editing:""},scopedSlots:e._u([{key:"default",fn:function({uciData:a}){return[t("vuci-named-section",{attrs:{"uci-data":a,"section-id":"name",title:e.title,endpoints:[{endpoint:`hotspot/themes/${e.theme}/config`,sectionFilter:s=>s[0]}],"data-key":e.section.file!=="landing_page.css"?`${e.theme}-${e.section.file.slice(0,-4)}`:`${e.theme}-css`,"after-save":e.afterSave},scopedSlots:e._u([{key:"default",fn:function({s}){return[t("vuci-form-item-text-area",{attrs:{"uci-section":s,name:"file",rows:"30"}})]}}],null,!0)}),e.resettable?t("div",{staticStyle:{display:"flex","justify-content":"flex-end",margin:"10px"}},[t("tlt-button",{attrs:{"button-id":"reset"},on:{click:e.resetText}},[e._v(" "+e._s(e.$t("Reset"))+" ")])],1):e._e()]}}]),model:{value:e.formData,callback:function(a){e.formData=a},expression:"formData"}})},g=[],$=u(d,p,g,!1,null,null,null,null);const _=$.exports,v={data(){return{displayValues:[{name:this.$t("Style"),description:this.$t("File contains all CSS style rules"),file:"landing_page.css"},{name:this.$t("Header"),description:this.$t("HTML header template"),file:"header.htm"},{name:this.$t("Login"),description:this.$t("Login page template"),file:"login.htm"},{name:this.$t("Login (MAC auth)"),description:this.$t("MAC authentication login page template"),file:"login_mac.htm"},{name:this.$t("Login (SMS OTP)"),description:this.$t("SMS OTP login page template"),file:"otp_login.htm"},{name:this.$t("Signup"),description:this.$t("Signup page template"),file:"signup.htm"},{name:this.$t("Signup (SMS OTP)"),description:this.$t("SMS OTP signup page template"),file:"otp_signup.htm"},{name:this.$t("Success"),description:this.$t("Success page template"),file:"success.htm"},{name:this.$t("Denied"),description:this.$t("Access denied page template"),file:"access_denied.htm"},{name:this.$t("TOS"),description:this.$t("Terms of Service"),file:"tos.htm"}],imgColumns:[{name:"name",label:this.$t("Name")},{name:"image",label:this.$t("Image")},{name:"path",label:this.$t("File path")}],columns:[{name:"name",label:this.$t("Name")},{name:"desc",label:this.$t("Description")},{name:"edit-buttons",label:this.$t("Actions")}],HotspotFileEdit:_}},methods:{loadDisplayValue(i,e){const t=this.displayValues.find(a=>a.file===i);return e==="name"?t.name:t.description}}};var y=function(){var e=this,t=e._self._c;return t("vuci-form",{attrs:{config:"landingpage",editing:""},scopedSlots:e._u([{key:"default",fn:function({uciData:a,editableSection:s}){return[t("vuci-typed-section",{attrs:{"uci-data":a,title:e.$t("Images"),help:e.$t("Here you can upload custom images for different objects"),columns:e.imgColumns,endpoints:[{endpoint:"hotspot/images/config/"+s.id,sectionFilter:n=>n}],"data-key":`${s.id}_themeImage`,"form-methods":["edit","get"],"section-id":"file_name"},scopedSlots:e._u([{key:"name",fn:function({s:n}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":n,name:"file_name"}})]}},{key:"image",fn:function({s:n}){return[t("vuci-form-item-upload",{attrs:{name:"path",option:n.file_name,"uci-section":n,endpoint:"/api/hotspot/images/config/"+s.id,"allow-path":`/hotspotlogin/themes/${s.id}/img/`}})]}},{key:"path",fn:function({s:n}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":n,name:"file_path"}})]}}],null,!0)}),t("vuci-typed-section",{attrs:{title:e.$t("Style settings"),help:e.$t("Using CSS you can customize how the landing page looks"),columns:e.columns,"uci-data":a,endpoints:[{endpoint:"hotspot/themes/options",sectionFilter:n=>n.file==="landing_page.css"}],"data-key":"style","section-id":"file","form-methods":["get"],"edit-form":e.HotspotFileEdit,"edit-form-props":{theme:s.id,resettable:s.custom!=="1"},"custom-edit-button":""},scopedSlots:e._u([{key:"name",fn:function({s:n}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":n,name:"file","display-value":o=>e.loadDisplayValue(o,"name")}})]}},{key:"desc",fn:function({s:n}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":n,name:"file","display-value":o=>e.loadDisplayValue(o,"desc")}})]}},{key:"edit-buttons",fn:function({s:n,actions:o}){return[t("div",{staticClass:"edit-button"},[t("vuci-form-item-button",{staticClass:"!gap-1",attrs:{"uci-section":n,name:"edit",type:"text","icon-left":"edit"},on:{click:function(c){return o.edit(n.file)}}},[e._v(e._s(e.$t("Edit")))])],1)]}}],null,!0)}),t("vuci-typed-section",{attrs:{title:e.$t("View settings"),help:e.$t("Here you can access default templates for Header, Login, Signup, Success, TOS and Denied pages and edit their HTML code."),columns:e.columns,"uci-data":a,endpoints:[{endpoint:"hotspot/themes/options",sectionFilter:n=>n.file!=="landing_page.css"}],"data-key":"views","section-id":"file","form-methods":["get"],"edit-form":e.HotspotFileEdit,"edit-form-props":{theme:s.id,resettable:s.custom!=="1"},"custom-edit-button":""},scopedSlots:e._u([{key:"name",fn:function({s:n}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":n,name:"file","display-value":o=>e.loadDisplayValue(o,"name")}})]}},{key:"desc",fn:function({s:n}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":n,name:"file","display-value":o=>e.loadDisplayValue(o,"desc")}})]}},{key:"edit-buttons",fn:function({s:n,actions:o}){return[t("div",{staticClass:"edit-button"},[t("vuci-form-item-button",{staticClass:"!gap-1",attrs:{"uci-section":n,name:"edit",type:"text","icon-left":"edit"},on:{click:function(c){return o.edit(n.file)}}},[e._v(e._s(e.$t("Edit")))])],1)]}}],null,!0)})]}}])})},k=[],b=u(v,y,k,!1,null,null,null,null);const T=b.exports,D={data(){return{formData:{},themeRequests:[],themeNames:[],sections:{},HotspotLandingpageEdit:T,cols:[{name:"name",label:this.$t("Name")},{name:"status",label:this.$t("Status")},{name:"export",label:this.$t("Download")}],currentTheme:"",defaultImageData:[{type:"file",path:"",file_name:"Logo",file_path:"<%=logo%>",name:"logo.svg"},{type:"file",file_name:"Favicon",file_path:"<%=favicon%>",name:"favicon.svg"},{type:"file",path:"",file_name:"Background",file_path:"<%=background%>",name:"background.svg"},{type:"file",path:"",file_name:"Loading",file_path:"<%=loading%>",name:"loading.gif"}],uploadErrors:{1:this.$t("Invalid file"),4:this.$t("Invalid custom theme file"),7:this.$t("Limit reached, 5 custom themes are allowed"),150:this.$t("Not enough free space in RAM"),default:this.$t("Package installation failed")}}},computed:{themeOptions(){return this.formData.themes.map(i=>[i.id,i.name])}},methods:{deleteTheme(i){this.$prompt({title:i.custom==="1"?this.$t('Are you sure you want to delete "%s" theme?').format(i.name):this.$t('Remove "Hotspot landing page %s" package?').format(i.name),content:i.custom==="1"?this.$t('"%s" theme will be removed.').format(i.name):this.$t("Once you remove the package, it will delete additional software from the device. A package can be re-installed to the device."),okText:this.$t("Delete"),cancelText:this.$t("Cancel"),onOk:()=>this.onOk(i),onCancel:()=>{}})},async onOk(i){this.$spin();try{await this.handleApiRequest(i),this.handleUIUpdates(),this.$message.success(this.$t("Theme deleted successfully"))}catch{this.$message.error(this.$t("Failed to remove theme"))}finally{this.$spin(!1)}},async handleApiRequest(i){i.custom==="1"?await this.$axios.delete(`/api/hotspot/themes/config/${i.id}`):await this.$axios.post("/api/package_manager/actions/remove_package",{data:{package:`hs_theme_${i.id}`}})},async handleUIUpdates(){this.themeRequests=[],this.themeNames=[],await this.$refs.section.reloadData()},downloadTheme(i){return this.$spin(),this.$utils.downloadFileApi(`/api/hotspot/themes/${i}/actions/download`,"application/x-targz","POST").then(()=>{this.$message.success(this.$t("Theme download was successful"))}).catch(()=>{this.$message.error(this.$t("Failed to download theme"))}).finally(()=>{this.$spin(!1)})},setCurrentTheme(){this.currentTheme=this.formData.landingPage[0].theme},generateRequests(i){var t;const e=(t=i.themes)==null?void 0:t.map(a=>"/api/hotspot/images/config/"+a.id);return e==null||e.unshift("/api/hotspot/themes/options"),e},fileFilter(i,e){return e==="style"?i.filter(t=>t.file==="landing_page.css"):i.filter(t=>t.file!=="landing_page.css")},generateFileRequests(i,e){e.forEach(t=>{i.forEach(a=>{a.file==="landing_page.css"?this.themeRequests.push(`/api/hotspot/themes/${t.id}/config/css`):this.themeRequests.push(`/api/hotspot/themes/${t.id}/config/${a.file.slice(0,-4)}`)}),this.themeNames.push(t.id)})},error(i,e){return this.$message.error(this.$t("Failed to load %s themes %s file data").format(i,e)),""},loadData(i){return this.$axios.bulkGet(this.generateRequests(i)).then(e=>{this.currentTheme=i.landingPage[0].theme;const t=e.shift();return e.forEach((a,s)=>{const n=i.themes[s].id;a.success?this.sections[`${n}_themeImage`]=this.defaultImageData.map(o=>a.data.some(c=>c.file_name===o.file_name)?{id:`${n}_${o.file_name}`,...a.data.find(c=>c.file_name===o.file_name)}:{id:`${n}_${o.file_name}`,...o}):this.$message.error(this.$t("Failed to load %s themes image.").format(n))}),this.sections.style=t.success?this.fileFilter(t.data,"style"):[],this.sections.views=t.success?this.fileFilter(t.data,"view"):[],this.generateFileRequests(t.data,i.themes)}).then(()=>{const e=[...new Set(this.themeRequests)];return this.$axios.bulkGet(e)}).then(e=>{const a=((o,c,l=[])=>{const r=[...o];for(;r.length;)l.push(r.splice(0,c));return l})(e,10),s=[["css","landing page"],["header","header"],["login","login"],["login_mac","login mac"],["otp_login","otp login"],["signup","signup"],["otp_signup","otp signup"],["success","success"],["access_denied","access denied"],["tos","tos"]];return[...new Set(this.themeNames)].forEach((o,c)=>{a[c].forEach((l,r)=>{l.data.name=s[r][0],this.sections[`${o}-${s[r][0]}`]=l.success?[l.data]:this.error(o,s[r][1])})}),this.sections}).catch(()=>{this.$message.error(this.$t("Failed to load data"))})},updateTableData(){var i;this.sections=Object.assign({},this.sections,(i=this.$refs.vuciForm)==null?void 0:i.uciData),this.$refs.vuciForm.updateUciData(this.sections),this.$refs.vuciForm.initialForm=this.sections,this.loadData(this.sections)},async afterPackageUpload({res:i}){return this.$spin(),i.success?(this.$refs.uploader.resetInput(),this.$spin(!1),await this.$refs.section.reloadData(),this.updateTableData(),this.$message.success(this.$t("Theme uploaded successfully"))):(this.$spin(!1),this.$message.error(this.$t("Failed to upload theme")))}}};var S=function(){var e=this,t=e._self._c;return t("vuci-form",{ref:"vuciForm",attrs:{config:"landingpage","after-load":e.loadData},scopedSlots:e._u([{key:"default",fn:function({uciData:a}){return[t("vuci-named-section",{attrs:{"uci-data":a,name:"general",endpoints:[{endpoint:"hotspot/themes/global"}],"data-key":"landingPage",title:e.$t("General settings"),"after-save":e.setCurrentTheme},scopedSlots:e._u([{key:"default",fn:function({s}){return[t("vuci-form-item-select",{attrs:{"uci-section":s,name:"theme",label:e.$t("Theme"),help:e.$t("Currently active theme. More themes can be installed using the Package Manager."),options:e.themeOptions}})]}}],null,!0)}),t("vuci-typed-section",{ref:"section",attrs:{type:"theme",title:e.$t("Themes"),"uci-data":a,columns:e.cols,endpoints:[{endpoint:"hotspot/themes/config"}],"form-methods":["get","delete"],"data-key":"themes","edit-form":e.HotspotLandingpageEdit},scopedSlots:e._u([{key:"name",fn:function({s}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":s,name:"name"}})]}},{key:"status",fn:function({s}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":s,name:"active","display-value":()=>s.id===e.currentTheme?e.$t("Active"):"-"}})]}},{key:"export",fn:function({s}){return[t("tlt-button",{attrs:{"button-id":"export",type:"text",size:"md","icon-left":"download",action:"add"},on:{click:function(n){return e.downloadTheme(s.id)}}},[e._v(e._s(e.$t("Download theme")))])]}},{key:"deleteBtn",fn:function({s}){return[t("tlt-button",{attrs:{"button-id":"delete",type:"text",color:"error",size:"md",disabled:s.id===e.currentTheme||s.id==="default"},on:{click:function(n){return e.deleteTheme(s)}}},[e._v(e._s(e.$t("Delete")))])]}}],null,!0)}),t("tlt-card",{attrs:{title:e.$t("Add custom theme")}},[t("tlt-form-model-item",{attrs:{label:e.$t("Upload custom theme")}},[t("tlt-upload",{ref:"uploader",attrs:{name:"custom_theme",action:"/api/hotspot/themes/config",instant:"",errors:e.uploadErrors},on:{uploaded:e.afterPackageUpload}})],1)],1)]}}]),model:{value:e.formData,callback:function(a){e.formData=a},expression:"formData"}})},F=[],w=u(D,S,F,!1,null,null,null,null);return w.exports});
