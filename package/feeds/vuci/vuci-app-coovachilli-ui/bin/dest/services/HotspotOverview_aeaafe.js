(function(n,d){typeof exports=="object"&&typeof module<"u"?module.exports=d():typeof define=="function"&&define.amd?define(d):(n=typeof globalThis<"u"?globalThis:n||self,n["services/HotspotOverview_js"]=d())})(this,function(){"use strict";const n={parse(a){return a.split(".").map(e=>Number(e))},compare(a,e){return a===e?0:this.ip2int(a)-this.ip2int(e)},int2ip(a){return(a>>>24)+"."+(a>>16&255)+"."+(a>>8&255)+"."+(a&255)},ip2int(a){return a.split(".").reduce((e,i)=>(e<<8)+parseInt(i,10),0)>>>0},cidrToRange(a){const[e,i]=a.split("/")??[],s=parseInt(i),t=n.ip2int(e)&-1<<32-s,r=t+Math.pow(2,32-s)-1;return[n.int2ip(t),n.int2ip(r)]},netmaskToNumber(a){const e=a.match(/(\d+)/g)??[];let i=0;for(const s of e)i+=(parseInt(s).toString(2).match(/1/g)||[]).length;return i},numberToMask(a){if(!a)return"-";const e=[];for(let i=0;i<4;i++){const s=Math.min(a,8);e.push(256-Math.pow(2,8-s)),a-=s}return e.join(".")},getIPRange(a,e){if(e){const i=n.netmaskToNumber(e),s=`${a}/${i}`;return n.cidrToRange(s)}else return n.cidrToRange(a)},checkIfInRange(a,e,i){const s=n.ip2int(e),t=n.ip2int(i),r=n.ip2int(a);return s<r&&t>r},subnetID(a,e){const i=[0,0,0,0];for(let s=0;s<4;s++)i[s]=a[s]&e[s];return i},broadcast(a,e){const i=[0,0,0,0];for(let s=0;s<4;s++)i[s]=a[s]|e[s];return i},wildcardMask(a){const e=[0,0,0,0];for(let i=0;i<4;i++)e[i]=255-a[i];return e}};function d(a,e,i,s,t,r,u,m){var o=typeof a=="function"?a.options:a;e&&(o.render=e,o.staticRenderFns=i,o._compiled=!0),s&&(o.functional=!0),r&&(o._scopeId="data-v-"+r);var l;if(u?(l=function(c){c=c||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!c&&typeof __VUE_SSR_CONTEXT__<"u"&&(c=__VUE_SSR_CONTEXT__),t&&t.call(this,c),c&&c._registeredComponents&&c._registeredComponents.add(u)},o._ssrRegister=l):t&&(l=m?function(){t.call(this,(o.functional?this.parent:this).$root.$options.shadowRoot)}:t),l)if(o.functional){o._injectStyles=l;var h=o.render;o.render=function(O,f){return l.call(f),h(O,f)}}else{var p=o.beforeCreate;o.beforeCreate=p?[].concat(p,l):[l]}return{exports:a,options:o}}const g={inject:["formOptions","handleError"],props:{section:{type:Object,required:!0}},data(){return{formData:{},landingPageState:this.section.landingpage==="ext",radiusPageState:this.section.mode==="radius",successOptions:[["uam",this.$t("Success page")],["original",this.$t("Original URL")],["custom",this.$t("Custom")]],protocolOptions:[["http","HTTP"],["https","HTTPS"]],landingPageOptions:[["int",this.$t("Internal")],["ext",this.$t("External")]],walledGardenPlaceholder:`example.com
www.example.com`,currentUsername:this.$session.username}},computed:{additionalInterfaces(){return this.formOptions().ifaceList().filter(a=>a[0]!==this.section.network)},userScriptsPermission(){return this.formOptions().systemUsers.find(e=>e.username===this.currentUsername).group==="root"},tabs(){return[{tab:"general",title:this.$t("General")},{tab:"advanced",title:this.$t("Advanced")},{tab:"radius",title:this.$t("Radius"),show:this.radiusPageState},{tab:"walledgarden",title:this.$t("Walled garden")},{tab:"uscripts",title:this.$t("User scripts"),show:this.userScriptsPermission},{tab:"urlparams",title:this.$t("URL parameters"),show:this.landingPageState}]},paramOptions(){const a=this.formOptions().wifiDevices.map(e=>[e.ssid,`${this.$t("SSID:")} ${e.ssid}`]);return a.push([this.formOptions().system.hostname,`${this.$t("Hostname:")} ${this.formOptions().system.hostname}`]),a.push([this.formOptions().system.fw_version,`${this.$t("FW version:")} ${this.formOptions().system.fw_version}`]),a},modeOptions(){const a=[["local",this.$t("Local users")],["radius",this.$t("Radius")],["mac_auth",this.$t("MAC authentication")]];return this.formOptions().modems.length!==0&&a.push(["sms_otp",this.$t("SMS OTP")]),a},groupOptions(){return this.formOptions().hotspotGroups.length!==0?this.formOptions().hotspotGroups.map(a=>a.name):[["",this.$t("No groups available")]]},clientCertificates(){const a=this.formOptions().certificates.filter(e=>e.cert_type!=="ca"&&e.type==="cert");return this.mapCertificateFiles(a)},privateKeys(){const a=this.formOptions().certificates.filter(e=>e.type==="key");return this.mapCertificateFiles(a)}},timers:{validateInterfaces:{time:1e3,autostart:!0,immediate:!0,repeat:!1}},methods:{validateScripts(a){return a.split(`
`)[0]!=="#!/bin/sh"?{isValid:!1,message:this.$t("File content must start with #!/bin/sh")}:{isValid:!0}},mapCertificateFiles(a){return a.map(e=>["/etc/certificates/"+e.fullname,e.fullname])},changeLandingPageState(a){this.landingPageState=a.model==="ext"},changeRadiusState(a){this.validateEnable(a),this.radiusPageState=a.model==="radius"},invokeInterfaceErrorMessage(){const a=this.formOptions().dhcp.find(i=>i.id===this.section.network&&i.enable_dhcpv4==="1");if(!a)return;const e=`/network/lan#id=${a.interface}`;this.$alert.error(this.$t('DHCP server is running on interface "%s". Please disable it').format('<a href="%s">%s</a>'.format(e,a.interface.toUpperCase())),!0)},invokeWirelessErrorMessage(){const a=this.formOptions().wirelessDevice.find(i=>i.wifi_id===this.section.network);if(!(a!=null&&a.network))return;const e=`/network/wireless/ssids#id=${a.id}`;this.$alert.error(this.$t("Please remove all networks attached to this wireless %s interface %s").format(' <a id="wifi-msg" href="%s">'.format(e),"</a>"),!0),this.$nextTick(()=>{const i=document.getElementById("wifi-msg");i.onclick=()=>this.$store.state.advancedEnabled?!0:(this.$prompt({title:this.$t("Switch to advanced mode?"),content:this.$t("To access wireless network configuration, you need to be in advanced mode."),okText:this.$t("Switch to advanced"),cancelText:this.$t("Stay in basic"),onOk:()=>this.$axios.put("/api/system/config/general",{data:{advanced:"1"}}).then(()=>{this.$store.commit("setAdvancedEnabled",!0),this.$router.push({path:"/network/wireless/ssids",hash:`id=${a.id}`})})}),!1)})},validateInterfaces(){this.section.network.match(/wifi\d+/)?this.invokeWirelessErrorMessage():this.invokeInterfaceErrorMessage()},validateEnable(a){const e=a.uciSection.mode==="local";a.uciSection.enabled==="1"&&e&&this.formOptions().users.length===0&&(this.$message.error(this.$t('To enable the hotspot please create at least one user where authentication is set to "local users".')),a.uciSection.enabled="0")},validateIPRange(a="",e=""){const[i,s]=n.getIPRange(e);return n.checkIfInRange(a,i,s)?{isValid:!0}:{isValid:!1,message:this.$t("IP Address should be in the range of Hotspot network")}},validateAddressList(a,e){return a.split(`
`).filter(t=>t===""?!1:(this.$VuciValidator.value=t,!this.$VuciValidator.hostname().isValid)).length!==0?{isValid:!1,message:this.$t("Domain names are accepted. E.g. example.com .")}:{isValid:!0}},getProfileObject(a){var e;return(e=this.formOptions().profiles.data.find(i=>i.id===a))==null?void 0:e.options},async profileChanged(a){this.formOptions().profiles.data.filter(i=>i.id!==a.model).forEach(i=>{this.deleteProfileData(a,i.id)});const e=this.getProfileObject(a.model);Object.keys(e).forEach(i=>{const s=e[i];i==="param1value"?this.$set(a.uciSection,i,this.formOptions().system.fw_version):this.$set(a.uciSection,i,s)}),a.model==="purple"&&a.uciSection.mode==="radius"&&(await this.$nextTick(),this.$set(a.uciSection,"swapoctets","1"))},deleteProfileData(a,e){const i=this.getProfileObject(e);Object.keys(a.uciSection).forEach(s=>{s in i&&this.$set(a.uciSection,s,"")})}}};var $=function(){var e=this,i=e._self._c;return i("vuci-form",{attrs:{config:"chilli",editing:""},scopedSlots:e._u([{key:"default",fn:function({uciData:s}){return[i("vuci-named-section",{attrs:{"uci-data":s,name:e.section.id,title:e.$t("General settings"),endpoints:[{endpoint:"hotspot/config"}],"data-key":"general","error-handlers":{edit:e.handleError}},scopedSlots:e._u([{key:"default",fn:function({s:t}){return[i("tlt-tabs",{attrs:{tabs:e.tabs},scopedSlots:e._u([{key:"general",fn:function(){return[i("vuci-form-item-select",{attrs:{"uci-section":t,name:"profile",label:e.$t("Configuration profile"),options:e.formOptions().profiles.options,initial:"default"},on:{change:e.profileChanged}}),i("vuci-form-item-switch",{attrs:{"uci-section":t,name:"enabled",label:e.$t("Enable"),help:e.$t("Enable hotspot functionality")},on:{change:e.validateEnable}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"net",label:e.$t("Hotspot network"),help:e.$t("E.g. 192.168.2.0/24"),rules:"ipmask4",placeholder:"192.168.2.0/24"}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"uamlisten",label:e.$t("IP address"),help:e.$t("Hotspot IP address"),rules:["ipaddr",r=>e.validateIPRange(r,t.net)],placeholder:"192.168.2.254"}}),i("vuci-form-item-select",{attrs:{"uci-section":t,name:"mode",label:e.$t("Authentication mode"),help:e.$t("Specifies the method used to authenticate users"),options:e.modeOptions},on:{change:e.changeRadiusState}}),i("vuci-form-item-switch",{attrs:{"uci-section":t,name:"macauth",label:e.$t("Enable MAC authentication"),help:e.$t("Enable MAC address authentication"),depend:t.mode==="radius"}}),i("vuci-form-item-switch",{attrs:{"uci-section":t,name:"duplicateusers",label:e.$t("Allow password duplicates"),help:e.$t("Allows more than one user to login with a same password."),depend:t.mode==="sms_otp",rmempty:!1}}),i("vuci-form-item-switch",{attrs:{"uci-section":t,name:"registerusers",label:e.$t("Allow signup"),help:e.$t("Allows users to sign up to hotspot"),depend:t.mode==="local"}}),i("vuci-form-item-switch",{attrs:{"uci-section":t,name:"enable_macpass",label:e.$t("Require password"),help:e.$t("Enables password requirement for MAC authentication."),depend:t.mode==="mac_auth"}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"macpass",label:e.$t("MAC auth password"),help:e.$t("Password for MAC authentication"),depend:t.enable_macpass==="1",required:"",rules:"credentials_validate",maxlength:"512",password:"",placeholder:e.$t("Password")}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"dynexpirationtime",label:e.$t("Expiration time"),help:e.$t("User expiration time in sec (0 means unlimited)."),depend:t.mode==="sms_otp"||t.registerusers==="1",initial:"0",placehodler:"0",rules:"uinteger",maxlength:"16"}}),i("vuci-form-item-select",{attrs:{"uci-section":t,name:"dyn_users_group",label:e.$t("Users group"),help:e.$t("Specifies the group of dynamically created users"),depend:t.mode==="sms_otp"||t.registerusers==="1"||t.mode==="mac_auth",options:e.groupOptions}}),i("vuci-form-item-select",{attrs:{"uci-section":t,name:"modemid",label:e.$t("Modem"),help:e.$t("SMS gateway to send one time paswords (OTP)"),depend:t.mode==="sms_otp"&&e.formOptions().modems>1,options:e.formOptions().modems}}),i("vuci-form-item-select",{attrs:{"uci-section":t,name:"landingpage",label:e.$t("Landing page"),help:e.$t("Location of the landing page"),options:e.landingPageOptions},on:{change:e.changeLandingPageState}}),i("vuci-form-item-switch",{attrs:{"uci-section":t,label:e.$t("Password encoding"),help:e.$t("Password encoding with the challenge"),depend:t.landingpage==="ext",name:"withchallenge"}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"uamserver",label:e.$t("Landing page address"),help:e.$t("External landing page address (http://www.example.com)"),rules:"protourl",placeholder:"http://www.example.com",depend:t.landingpage==="ext"}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"uamport",label:e.$t("UAM port"),help:e.$t("Port to bind for authenticating clients"),rules:"port",initial:"3990",placeholder:"3990"}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"uamsecret",label:e.$t("UAM secret"),help:e.$t("Shared secret between uamserver and hotspot"),rules:"credentials_validate",maxlength:"512",depend:t.landingpage==="ext"&&t.nochallenge,password:""}}),i("vuci-form-item-select",{attrs:{"uci-section":t,name:"success",label:e.$t("Success page"),help:e.$t("Location to return to after successful authentication"),options:e.successOptions}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"success_url",label:e.$t("Custom URL"),help:e.$t("Address must contain protocol (http://www.example.com)"),depend:t.success==="custom",rules:"protourl",placeholder:"http://www.example.com"}})]},proxy:!0},{key:"advanced",fn:function(){return[i("vuci-form-item-select",{attrs:{"uci-section":t,name:"moreif",label:e.$t("Additional interfaces"),help:e.$t("Choose additional the interfaces you want to attach to this hotspot instance"),options:e.additionalInterfaces,multiple:"",placeholder:e.$t("-- Please select --")}}),i("vuci-form-item-switch",{attrs:{"uci-section":t,name:"mac_blocking",label:e.$t("Enable MAC blocking"),help:e.$t("Blocks access to MAC addresses that have reached set amount of failed login attempts"),depend:t.mode!=="radius"}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"uamlogoutip",label:e.$t("Logout address"),help:e.$t("IP address to instantly logout a client accessing it"),rules:"ip4addr",placeholder:"1.0.0.0",initial:"1.0.0.0"}}),i("vuci-form-item-select",{attrs:{"uci-section":t,name:"protocol",label:e.$t("Protocol"),help:e.$t("Protocol to be used for landing page"),options:e.protocolOptions,depend:t.landingpage==="int"}}),i("vuci-form-item-switch",{attrs:{"uci-section":t,name:"tos",label:e.$t("Enable TOS"),help:e.$t("Enables Terms of Service (ToS) requirement. Cient device will be able to access the Internet             only after agreeing TOS")}}),i("vuci-form-item-switch",{attrs:{"uci-section":t,name:"trialusers",label:e.$t("Trial access"),help:e.$t("Enables trial internet access")}}),i("vuci-form-item-select",{attrs:{"uci-section":t,name:"trial_users_group",label:e.$t("Group"),help:e.$t("Specifies the group of trial users"),options:e.groupOptions,depend:t.trialusers==="1",initial:"default"}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"subdomain",label:e.$t("Subdomain"),help:e.$t("Combined with Domain to make a DNS alias for the Hotspot IP address"),depend:t.landingpage==="ext",required:t.domain!=="",maxlength:"63",rules:"fieldvalidation('^[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]$',0)",placeholder:"login"}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"domain",label:e.$t("Domain"),help:e.$t("Combined with Subdomain to make a DNS alias for the Hotspot IP address"),depend:t.landingpage==="ext",required:t.subdomain!=="",rules:"hostname",placeholder:"hotspot.local"}}),i("vuci-form-item-switch",{attrs:{"uci-section":t,name:"https_redirect",label:e.$t("HTTPS to landing page redirect"),help:e.$t("Redirect initial pre-landing page HTTPS requests to hotspot landing page")}}),i("vuci-form-item-switch",{attrs:{"uci-section":t,name:"device_files",label:e.$t("Certificate files from device"),help:e.$t("Choose this option if you want to select certificate files from device.            Certificate files can be generated %s here %s").format("<a class=link href='/system/admin/certificates/generation'>","</a>"),depend:t.https_redirect==="1",rawhtml:""}}),i("vuci-form-item-upload",{attrs:{"uci-section":t,name:"sslkeyfile",label:e.$t("SSL key file"),depend:t.https_redirect==="1"&&t.device_files==="0",load:e.formData.device_files==="1"?"":t.name,"force-write":"","max-size":"16MB"}}),i("vuci-form-item-select",{attrs:{"uci-section":t,name:"device_sslkeyfile",label:e.$t("SSL key file"),depend:t.https_redirect==="1"&&t.device_files==="1",options:e.privateKeys,"force-write":""}}),i("vuci-form-item-upload",{attrs:{"uci-section":t,name:"sslcertfile",label:e.$t("SSL certificate file"),depend:t.https_redirect==="1"&&t.device_files==="0",load:e.formData.device_files==="1"?"":t.name,"force-write":"","max-size":"16MB"}}),i("vuci-form-item-select",{attrs:{"uci-section":t,name:"device_sslcertfile",label:e.$t("SSL certificate file"),depend:t.https_redirect==="1"&&t.device_files==="1",options:e.clientCertificates}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"dns1",label:e.$t("Primary DNS server"),rules:"ipaddr",placeholder:"8.8.8.8"}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"dns2",label:e.$t("Secondary DNS server"),rules:"ipaddr",placeholder:"8.8.4.4"}})]},proxy:!0},{key:"radius",fn:function(){return[i("vuci-form-item-input",{attrs:{"uci-section":t,name:"radiusserver1",label:e.$t("RADIUS server #1"),help:e.$t("The IP address of the first RADIUS server that is to be used to authenticate your wireless clients"),rules:"host",required:t.mode==="radius",depend:t.mode==="radius"}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"radiusserver2",label:e.$t("RADIUS server #2"),help:e.$t("The IP address of the second RADIUS server that is to be used to authenticate your wireless clients"),rules:"host",depend:t.mode==="radius"}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"radiusauthport",label:e.$t("Authentication port"),help:e.$t("RADIUS server authentication port"),rules:"port",initial:"1812",depend:t.mode==="radius"}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"radiusacctport",label:e.$t("Accounting port"),help:e.$t("RADIUS server accounting port"),rules:"port",initial:"1813",depend:t.mode==="radius"}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"radiusnasid",label:e.$t("NAS identifier"),help:e.$t("NAS identifier"),depend:t.mode==="radius",rules:"credentials_validate",maxlength:"512",required:t.profile==="hotspotsystems"}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"radiussecret",label:e.$t("Radius secret key"),help:e.$t("The secret key is used for authentication with the RADIUS server"),depend:t.mode==="radius",rules:"credentials_validate",maxlength:"512",password:""}}),i("vuci-form-item-switch",{attrs:{"uci-section":t,name:"swapoctets",label:e.$t("Swap octets"),help:e.$t("Swap the meaning of input octets and output octets as it is related to RADIUS attributes"),depend:t.mode==="radius"}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"locationname",label:e.$t("Location name"),depend:t.mode==="radius",rules:"defaulttype"}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"radiuslocationid",label:e.$t("Location ID"),depend:t.mode==="radius",rules:"defaulttype"}})]},proxy:!0},{key:"walledgarden",fn:function(){return[i("vuci-form-item-text-area",{attrs:{"uci-section":t,name:"uamdomainfile",label:e.$t("Address list"),help:e.$t("List of addresses the client can access without first authenticating. One record per line. See placeholder for accepted formats."),placeholder:e.walledGardenPlaceholder,rules:e.validateAddressList}})]},proxy:!0},{key:"urlparams",fn:function(){return[i("vuci-form-item-input",{attrs:{"uci-section":t,name:"paramuamip",label:e.$t("UAM IP"),help:e.$t("The IP Address of the Captive Portal gateway"),depend:t.landingpage==="ext",placeholder:"uamip",rules:"urlparam"}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"paramuamport",label:e.$t("UAM port"),help:e.$t("The port on which the Captive Portal will serve web content"),depend:t.landingpage==="ext",placeholder:"uamport",rules:"urlparam"}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"paramcalled",label:e.$t("Called"),help:e.$t("The MAC address of the IP Address of the Captive Portal gateway"),depend:t.landingpage==="ext",placeholder:"called",rules:"urlparam"}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"parammac",label:e.$t("MAC"),help:e.$t("The MAC address of the client trying to gain Internet access"),depend:t.landingpage==="ext",placeholder:"mac",rules:"urlparam"}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"paramip",label:e.$t("IP"),help:e.$t("The IP Address of the client trying to gain Internet access"),depend:t.landingpage==="ext",placeholder:"ip",rules:"urlparam"}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"paramnasid",label:e.$t("NAS id"),help:e.$t("An identification for the Captive Portal used in the RADIUS request"),depend:t.landingpage==="ext",placeholder:"nasid",rules:"urlparam"}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"paramsessionid",label:e.$t("Session id"),help:e.$t("The unique identifer for session"),depend:t.landingpage==="ext",placeholder:"sessionid",rules:"urlparam"}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"paramuserurl",label:e.$t("User url"),help:e.$t("The URL which the user tried to access before he were redirected to the             Captive Portal's URL's pages"),depend:t.landingpage==="ext",placeholder:"userurl",rules:"urlparam"}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"paramchallenge",label:e.$t("Challenge"),help:e.$t("A challenge that should be used together with the user's password to create             an encrypted phrase used to log on"),depend:t.landingpage==="ext"&&t.nochallenge,placeholder:"challenge",rules:"urlparam"}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"param1",label:e.$t("Custom 1"),help:e.$t("Add custom name and custom value which will be displayed in url parameters"),depend:t.landingpage==="ext",placeholder:e.$t("Custom name"),rules:"urlparam"}}),i("vuci-form-item-select",{attrs:{"uci-section":t,name:"param1value",label:" ",depend:t.landingpage==="ext",placeholder:e.$t("Custom name"),rules:"credentials_validate('allow-space')",maxlength:"512",options:e.paramOptions,"allow-create":""}}),i("vuci-form-item-input",{attrs:{"uci-section":t,name:"param2",label:e.$t("Custom 2"),help:e.$t("Add custom name and custom value which will be displayed in url parameters"),depend:t.landingpage==="ext",placeholder:e.$t("Custom name"),rules:"urlparam"}}),i("vuci-form-item-select",{attrs:{"uci-section":t,name:"param2value",label:" ",depend:t.landingpage==="ext",placeholder:e.$t("Custom name"),rules:"credentials_validate('allow-space')",maxlength:"512",options:e.paramOptions,"allow-create":""}})]},proxy:!0},{key:"uscripts",fn:function(){return[i("vuci-form-item-text-area",{attrs:{"uci-section":t,name:"conup",label:e.$t("Session up"),help:e.$t("Script executed after a session is authorized.             Executed with the environment variables (Please refer to the             %s wiki %s).").format("<a href='"+e.$brand("wikiURL")+"'>","</a>"),rawhtml:"",rules:e.validateScripts,placeholder:'#!/bin/sh\n/usr/bin/logger -t "example" "Example user ${USER_NAME} logged on."'}}),i("vuci-form-item-text-area",{attrs:{"uci-section":t,name:"condown",label:e.$t("Session down"),help:e.$t("Script executed after a session has moved from authorized state to unauthorized.             Executed with the environment variables (Please refer to the             %s wiki %s).").format("<a href='"+e.$brand("wikiURL")+"'>","</a>"),rawhtml:"",rules:e.validateScripts,placeholder:'#!/bin/sh\n/usr/bin/logger -t "example" "Example user ${USER_NAME} logged out."'}}),i("vuci-form-item-text-area",{attrs:{"uci-section":t,name:"usersignup",label:e.$t("User signup"),help:e.$t("Script executed after a new user has been created during signup process.             Executed with the environment variables (Please refer to the             %s wiki %s).").format("<a href='"+e.$brand("wikiURL")+"'>","</a>"),rawhtml:"",rules:e.validateScripts,placeholder:'#!/bin/sh\n/usr/bin/logger -t "example" "New user created ${USER_NAME}."'}})]},proxy:!0}],null,!0)})]}}],null,!0)})]}}]),model:{value:e.formData,callback:function(s){e.formData=s},expression:"formData"}})},v=[],b=d(g,$,v,!1,null,null,null,null);const w=b.exports,y={provide(){return{formOptions:this.getFormOptions,handleError:this.handleError}},data(){return{formData:{},columns:[{name:"auth_mode",label:this.$t("Auth mode")},{name:"ip",label:this.$t("IP")},{name:"ifaces",label:this.$t("Interfaces")},{name:"enable"}],modeDisplayValues:{radius:this.$t("External RADIUS"),local:this.$t("Local users"),sms_otp:this.$t("SMS OTP"),mac_auth:this.$t("MAC Auth")},profiles:{hotspotsystems:this.$t("Hotspot systems"),default:this.$t("Default"),cloud4wi:this.$t("Cloud4wi"),purple:this.$t("Purple portal")},HotspotEdit:w,ifaceStatuses:[],formOptions:{wifiDevices:[],modems:[],users:[],hotspotGroups:[],ifaceList:this.interfaceList,certificates:[],system:{},profiles:{options:[],data:[]},dhcp:[],systemUsers:[],wirelessDevice:[]},errors:{1:this.$t("Hotspot network subnet is already being used by network interface")}}},methods:{getFormOptions(){return this.formOptions},interfaceList(){const a=this.ifaceStatuses.filter(i=>i.interface&&i.device&&i.interface!=="loopback"&&i.area_type==="lan").map(i=>[this.$network.getName(i),`${this.$network.getName(i)} (${i.device})`]),e=this.formOptions.wifiDevices.filter(i=>!i.disabled).map(i=>[i.wifi_id,`${i.ssid}${i.ifname?` (${i.ifname})`:""}`]);return a.concat(e)},loadMode(a){return this.modeDisplayValues[a]||"-"},addSection(){return this.formData.general.length>0?{message:this.$t("Only 1 instance available"),valid:!1}:{valid:!0}},displayErrorMessage(a){const e={interfaces:this.$t("Failed to load interface data"),interfaceStatus:this.$t("Failed to load interface statuses"),users:this.$t("Failed to load hotspot user data"),groups:this.$t("Failed to load hotspot group data"),certificates:this.$t("Failed to load certificate data"),wireless:this.$t("Failed to load wireless data"),profiles:this.$t("Failed to load profile data"),system:this.$t("Failed to load system data"),modem:this.$t("Failed to load modem data"),dhcp:this.$t("Failed to load dhcp data"),susers:this.$t("Failed to load system user data"),sgroups:this.$t("Failed to load system group data")};return this.$message.error(e[a]),[]},loadData(){const a=["/api/hotspot/users/config","/api/interfaces/status","/api/hotspot/groups/config","/api/certificates/config","/api/hotspot/options","/api/system/device/status",{endpoint:"/api/modems/status",condition:"mobifd.control"},{endpoint:"/api/wireless/interfaces/basic/status",condition:"wireless-regdb.control"},"/api/dhcp/servers/ipv4/config","/api/users/config",{endpoint:"/api/wireless/interfaces/config",condition:"wireless-regdb.control"}];return this.$axios.bulkGet(a).then(([e,i,s,t,r,u,m,o,l,h,p])=>{this.formOptions.dhcp=l.success?l.data:this.displayErrorMessage("dhcp"),this.ifaceStatuses=i.success?i.data:this.displayErrorMessage("interfaceStatus"),this.formOptions.users=e.success?e.data:this.displayErrorMessage("users"),this.formOptions.hotspotGroups=s.success?s.data:this.displayErrorMessage("groups"),this.formOptions.certificates=t.success?t.data.generated:this.displayErrorMessage("certificates"),this.formOptions.modems=m.success?this.$mobile.modemsOptions(m.data):this.displayErrorMessage("modem"),this.formOptions.profiles=r.success?this.mapProfiles(r.data):this.displayErrorMessage("profiles"),this.formOptions.system=u.success?u.data.static:this.displayErrorMessage("system"),this.formOptions.systemUsers=h.success?h.data:this.displayErrorMessage("susers"),this.formOptions.wifiDevices=o.success?o.data:this.displayErrorMessage("wireless"),this.formOptions.wirelessDevice=p.success?p.data:this.displayErrorMessage("wireless")}).catch(()=>{this.$message.error(this.$t("An unexpected error occurred"))})},mapProfiles(a){return{options:a.map(e=>[e.id,this.profiles[e.id]]),data:a}},network(){const a=this.formData.general[0].network,e=this.formData.general[0].moreif?[...this.formData.general[0].moreif]:[];e.includes(a)||e.push(a);const i=[];for(const s of e)if(s.match(/wifi\d+/g)){const t=this.formOptions.wifiDevices.find(r=>r.wifi_id===s);i.push(`${(t==null?void 0:t.ssid)??"-"}`+(t!=null&&t.ifname?`(${t.ifname})`:""))}else i.push(s);return i},validateEnable(a){const e=this.formData.general.some(i=>i.mode==="local");a.model==="1"&&e&&this.formOptions.users.length===0&&(this.$message.error(this.$t('To enable the hotspot please create at least one user where authentication is set to "local users".')),a.model="0")},handleError(a){var i,s;const e=a!=null&&a.payload?(s=(i=a==null?void 0:a.payload[0])==null?void 0:i.errors[0])==null?void 0:s.code:a==null?void 0:a.data.errors[0].code;return this.errors[e]||this.$t("An unexpected error occurred")}}};var _=function(){var e=this,i=e._self._c;return i("vuci-form",{attrs:{config:"chilli","after-load":e.loadData},scopedSlots:e._u([{key:"default",fn:function({uciData:s}){return[i("vuci-typed-section",{attrs:{type:"chilli","uci-data":s,title:e.$t("Hotspot instances"),columns:e.columns,"edit-form":e.HotspotEdit,endpoints:[{endpoint:"hotspot/config"}],"data-key":"general","add-validate":e.addSection,"error-handlers":{edit:e.handleError}},scopedSlots:e._u([{key:"auth_mode",fn:function({s:t}){return[i("vuci-form-item-dummy",{attrs:{"uci-section":t,name:"mode","display-value":e.loadMode}})]}},{key:"ip",fn:function({s:t}){return[i("vuci-form-item-dummy",{attrs:{"uci-section":t,name:"uamlisten"}})]}},{key:"ifaces",fn:function(){return e._l(e.network(),function(t){return i("div",{key:t},[e._v(" "+e._s(t)+" ")])})},proxy:!0},{key:"enable",fn:function({s:t}){return[i("vuci-form-item-switch",{attrs:{"uci-section":t,name:"enabled"},on:{change:e.validateEnable}})]}},{key:"addForm",fn:function({addModel:t}){return[i("tlt-form-item-select",{attrs:{required:"",label:e.$t("Interface"),prop:"network",options:e.interfaceList()},model:{value:t.network,callback:function(r){e.$set(t,"network",r)},expression:"addModel.network"}})]}}],null,!0)})]}}]),model:{value:e.formData,callback:function(s){e.formData=s},expression:"formData"}})},S=[],k=d(y,_,S,!1,null,null,null,null);return k.exports});
