(function(c,u){typeof exports=="object"&&typeof module<"u"?module.exports=u():typeof define=="function"&&define.amd?define(u):(c=typeof globalThis<"u"?globalThis:c||self,c["services/STunnel_js"]=u())})(this,function(){"use strict";function c(o,e,t,a,i,n,p,k){var r=typeof o=="function"?o.options:o;e&&(r.render=e,r.staticRenderFns=t,r._compiled=!0),a&&(r.functional=!0),n&&(r._scopeId="data-v-"+n);var s;if(p?(s=function(l){l=l||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!l&&typeof __VUE_SSR_CONTEXT__<"u"&&(l=__VUE_SSR_CONTEXT__),i&&i.call(this,l),l&&l._registeredComponents&&l._registeredComponents.add(p)},r._ssrRegister=s):i&&(s=k?function(){i.call(this,(r.functional?this.parent:this).$root.$options.shadowRoot)}:i),s)if(r.functional){r._injectStyles=s;var O=r.render;r.render=function(I,m){return s.call(m),O(I,m)}}else{var d=r.beforeCreate;r.beforeCreate=d?[].concat(d,s):[s]}return{exports:o,options:r}}const u={props:{section:{type:Object,required:!0}},data(){return{modeOptions:[["0",this.$t("Server")],["1",this.$t("Client")]],tlsCipherOptions:[["none",this.$t("None")],["dhe_rsa",this.$t("Secure")],["custom",this.$t("Custom")]],appProtocolOptions:[["",this.$t("Not specified")],["connect",this.$t("Connect")],["smtp",this.$t("SMTP")]],connectAuthOptions:[["basic",this.$t("Basic")],["ntlm",this.$t("NTLM")]],smtpAuthOptions:[["plain",this.$t("Plain")],["login",this.$t("Login")]]}},methods:{getCipherWarning(o){if(typeof o!="string")return;const e=o.toLowerCase().substring(0,3);if(["des"].includes(e))return this.$t("This privacy type is not considered secure. Consider using a more secure privacy type, such as AES.")},validateListenIP(o){this.$VuciValidator.value=o;const e=this.$VuciValidator.ipaddr();return o==="localhost"||e.isValid?{isValid:!0}:{isValid:!1,message:this.$t("One of the following: IPv4 and IPv6 addresses are accepted. E.g. 192.168.1.1. Following words are accepted: localhost")}}}};var f=function(){var e=this,t=e._self._c;return t("vuci-form",{attrs:{editing:"",config:"stunnel"},scopedSlots:e._u([{key:"default",fn:function({uciData:a,editableSection:i}){return[t("vuci-named-section",{attrs:{name:i.id,title:e.$t("Stunnel Configuration: %s").format(i.id),"uci-data":a,endpoints:[{endpoint:"stunnel/config"}],"data-key":"stunnels"},scopedSlots:e._u([{key:"default",fn:function({s:n}){return[t("vuci-form-item-switch",{attrs:{"uci-section":n,label:e.$t("Enable"),help:e.$t("Enable Stunnel"),name:"enabled"}}),t("vuci-form-item-select",{attrs:{"uci-section":n,label:e.$t("Operating Mode"),help:`${e.$t("Stunnel operation mode.")} <br> *
              ${e.$t("Server - Only listening on specified IP and Port.")} <br> *
              ${e.$t("Client - Both listening and connecting to specified IPs")}`,name:"client",initial:"0",options:e.modeOptions,rawhtml:""}}),t("vuci-form-item-input",{attrs:{"uci-section":n,label:e.$t("Listen IP"),help:e.$t("IP which server will be listening to"),name:"accept_host",placeholder:"localhost",rules:e.validateListenIP,required:""}}),t("vuci-form-item-input",{attrs:{"uci-section":n,label:e.$t("Listen Port"),help:e.$t("Port number which server will be listenting to (range 0:65535)"),name:"accept_port",placeholder:"80",rules:"port",required:""}}),t("vuci-form-item-list",{attrs:{"uci-section":n,label:e.$t("Connect IP's"),help:`${e.$t("Type in the server IP and Port (using 'host_ip:port' convention (i.e. 127.0.0.1:6001)).")} <br>
              ${e.$t("If no host IP is specified only port number, then localhost will be used as a host")}`,name:"connect",placeholder:"0.0.0.0:80",rules:"hostport",rawhtml:"",required:""}}),t("vuci-form-item-select",{attrs:{"uci-section":n,label:e.$t("TLS Cipher"),help:e.$t("Packet encryption algorithm (cipher)"),name:"cipher_type",options:e.tlsCipherOptions,"force-write":""},on:{change:function(p){n.ciphers=""}}}),t("vuci-form-item-list",{attrs:{"uci-section":n,label:e.$t("Allowed TLS Ciphers"),warnings:e.getCipherWarning,depend:n.cipher_type==="custom",name:"ciphers",rules:"string"}}),t("vuci-form-item-select",{attrs:{"uci-section":n,label:e.$t("Applicaton Protocol"),help:`${e.$t("This option enables initial, protocol-specific negotiation of the TLS encryption.")} <br>
              ${e.$t("The protocol option should not be used with TLS encryption on a separate port.")}`,name:"protocol",options:e.appProtocolOptions,rawhtml:""}}),t("vuci-form-item-select",{attrs:{"uci-section":n,label:e.$t("Protocol Authentication"),help:e.$t("Packet encryption algorithm (cipher)"),name:"protocolAuthentication",depend:n.protocol==="connect",options:e.connectAuthOptions}}),t("vuci-form-item-select",{attrs:{"uci-section":n,label:e.$t("Protocol Authentication"),help:e.$t("Packet encryption algorithm (cipher)"),name:"protocolAuthentication",depend:n.protocol==="smtp",options:e.smtpAuthOptions}}),t("vuci-form-item-input",{attrs:{"uci-section":n,label:e.$t("Protocol Domain"),help:e.$t("Domain for the protocol negotiations"),name:"protocolDomain",rules:"string",depend:n.protocol==="connect"&&n.client==="1"}}),t("vuci-form-item-input",{attrs:{"uci-section":n,label:e.$t("Protocol Host"),help:e.$t("Specifies the final TLS server to be connected to by the proxy, and not the proxy server directly connected by stunnel"),name:"protocolHost",rules:"string",depend:n.protocol==="connect"&&n.client==="1"}}),t("vuci-form-item-input",{attrs:{"uci-section":n,label:e.$t("Protocol Username"),help:e.$t("Username for the protocol negotiations"),name:"protocolUsername",rules:"credentials_validate",maxlength:"512",depend:(n.protocol==="connect"||n.protocol==="smtp")&&n.client==="1"}}),t("vuci-form-item-input",{attrs:{"uci-section":n,label:e.$t("Protocol Password"),help:e.$t("Password for the protocol negotiations"),name:"protocolPassword",rules:"credentials_validate",maxlength:"512",depend:(n.protocol==="connect"||n.protocol==="smtp")&&n.client==="1"}}),t("vuci-form-item-upload",{attrs:{"uci-section":n,name:"cert",label:e.$t("Certificate File"),help:e.$t("Certificate file in pem format"),rawhtml:"",depend:n.client==="0","max-size":"16MB"}}),t("vuci-form-item-upload",{attrs:{"uci-section":n,name:"key",label:e.$t("Private Key"),help:e.$t("Key file in pem format"),depend:n.client==="0","max-size":"16MB"}}),t("vuci-form-item-upload",{attrs:{"uci-section":n,name:"CAfile",label:e.$t("Remote server certificate"),help:e.$t("Certificate file of the remote peer (server) in pem format."),depend:n.client==="1","max-size":"16MB"}})]}}],null,!0)})]}}])})},h=[],$=c(u,f,h,!1,null,null,null,null);const v=$.exports,_={inject:["form"],methods:{afterSave(o,e){e.data.enabled==="0"&&this.form().stunnels.forEach(t=>t.enabled="0")}}};var g=function(){var e=this,t=e._self._c;return t("vuci-form",{attrs:{editing:"",config:"stunnel"},scopedSlots:e._u([{key:"default",fn:function({uciData:a}){return[t("vuci-named-section",{attrs:{name:"globals",title:e.$t("Stunnel Global Settings"),"uci-data":a,endpoints:[{endpoint:"stunnel/global"}],"data-key":"global","after-save":e.afterSave},scopedSlots:e._u([{key:"default",fn:function({s:i}){return[t("vuci-form-item-switch",{attrs:{"uci-section":i,label:e.$t("Enabled"),help:e.$t("Enable service"),name:"enabled"}}),t("vuci-form-item-input",{attrs:{"uci-section":i,label:e.$t("Debug Level"),help:e.$t("Level of output to log:      emerg (0), alert (1), crit (2), err (3),      warning (4), notice (5), info (6), or debug (7)"),name:"debug",placeholder:"5",initial:"5",rules:"range(0,7)"}}),t("vuci-form-item-switch",{attrs:{"uci-section":i,label:e.$t("Use alternative config"),help:`${e.$t("Enable alternative configuration option (Config upload).")} <br> *
      ${e.$t("Be aware that when using alternative configuration, all configurations in 'Stunnel Configuration' section will be skipped.")}`,name:"use_alt",rawhtml:""}}),t("vuci-form-item-upload",{attrs:{"uci-section":i,name:"alt_config_file",label:e.$t("Upload alternative config"),endpoint:"/api/stunnel/global",depend:i.use_alt==="1"}})]}}],null,!0)})]}}])})},b=[],y=c(_,g,b,!1,null,null,null,null);const S=y.exports,C={provide(){return{form:()=>this.formData}},data(){return{formData:{},editModal:v,globalModal:S,deviceColumns:[{name:"name",label:this.$t("Tunnel name"),help:this.$t("Name of the tunnel. Used for easier tunnels management purpose only")},{name:"accept_host",label:this.$t("Listening on"),help:this.$t("IP and port which server will be listening to")},{name:"client",label:this.$t("Operation mode"),help:`${this.$t("Stunnel operation mode.")} <br> * ${this.$t("Server - Only listening on specified IP and Port.")} <br> * ${this.$t("Client - Both listening and connecting to specified IPs")}`,rawhtml:!0},{name:"enabled"}]}},methods:{onAdd(o,e){return e.filter(t=>t[".type"]==="service").length>4?{valid:!1,message:this.$t("Can't create more instances. Only 5 STunnel instances are allowed")}:{valid:!0}},displayHost(o,e){return e.uciSection.accept_host&&e.uciSection.accept_port?`${e.uciSection.accept_host}:${e.uciSection.accept_port}`:this.$t("Not set")},displayClient(o){return o==="1"?this.$t("Client"):o==="0"?this.$t("Server"):this.$t("Not set")}}};var P=function(){var e=this,t=e._self._c;return t("vuci-form",{attrs:{config:"stunnel"},scopedSlots:e._u([{key:"default",fn:function({uciData:a}){return[t("vuci-typed-section",{attrs:{type:"service",title:e.$t("Stunnel Configuration"),help:e.$t("This section displays STunnel instances currently existing on the router."),columns:e.deviceColumns,"edit-form":e.editModal,endpoints:[{endpoint:"stunnel/config"}],"data-key":"stunnels","uci-data":a,"add-validate":e.onAdd,"global-settings-form":e.globalModal},scopedSlots:e._u([{key:"name",fn:function({s:i}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":i,name:"id"}})]}},{key:"accept_host",fn:function({s:i}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":i,name:"accept_host","display-value":e.displayHost}})]}},{key:"client",fn:function({s:i}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":i,name:"client","display-value":e.displayClient}})]}},{key:"enabled",fn:function({s:i}){return[t("vuci-form-item-switch",{attrs:{"uci-section":i,name:"enabled"}})]}},{key:"addForm",fn:function({addModel:i}){return[t("tlt-form-item-input",{attrs:{label:e.$t("New configuration name"),prop:"id",required:"",help:e.$t("Name of the new STunnel configuration. Used for easier configurations management purpose only."),rules:"uciname",maxlength:"8"},model:{value:i.id,callback:function(n){e.$set(i,"id",n)},expression:"addModel.id"}})]}}],null,!0)})]}}]),model:{value:e.formData,callback:function(a){e.formData=a},expression:"formData"}})},w=[],T=c(C,P,w,!1,null,null,null,null);return T.exports});
