(function(f,u){typeof exports=="object"&&typeof module<"u"?module.exports=u():typeof define=="function"&&define.amd?define(u):(f=typeof globalThis<"u"?globalThis:f||self,f["services/Sqm_js"]=u())})(this,function(){"use strict";function f(i,e,s,r,n,o,t,c){var a=typeof i=="function"?i.options:i;e&&(a.render=e,a.staticRenderFns=s,a._compiled=!0),r&&(a.functional=!0),o&&(a._scopeId="data-v-"+o);var l;if(t?(l=function(d){d=d||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!d&&typeof __VUE_SSR_CONTEXT__<"u"&&(d=__VUE_SSR_CONTEXT__),n&&n.call(this,d),d&&d._registeredComponents&&d._registeredComponents.add(t)},a._ssrRegister=l):n&&(l=c?function(){n.call(this,(a.functional?this.parent:this).$root.$options.shadowRoot)}:n),l)if(a.functional){a._injectStyles=l;var p=a.render;a.render=function(k,h){return l.call(h),p(k,h)}}else{var m=a.beforeCreate;a.beforeCreate=m?[].concat(m,l):[l]}return{exports:i,options:a}}const u={inject:["formOptions"],props:{section:{type:Object,required:!0}},data(){return{sqmEditTabs:[{tab:"general",title:this.$t("General Setup")},{tab:"advanced",title:this.$t("Advanced Settings")}],downloadHint:`${this.$t("(Ingress) set to 0 to selectively disable ingress shaping.")}<br>
      ${this.$t("For better results it's recommended to use 85% of your bandwidth speed.")}`,uploadHint:`${this.$t("(Egress) set to 0 to selectively disable egress shaping.")}<br>
      ${this.$t("For better results it's recommended to use 85% of your bandwidth speed.")}`,scriptOptDescripts:{"piece_of_cake.qos":`<p><b>piece_of_cake.qos</b><br>${this.$t("This just uses the cake qdisc as a replacement for both htb as shaper and fq_codel as leaf qdisc.")}
        ${this.$t('It just does not come any simpler than this, in other words it truely is a "piece of cake".')}</p>`,"layer_cake.qos":`<p><b>layer_cakes.qos</b><br>${this.$t("This uses the cake qdisc as a replacement for both htb as shaper and fq_codel as leaf qdisc.")}
        ${this.$t(`This exercises cake's diffserv profile(s) as different "layers" of priority.`)}</p>`,"simple.qos":`<p><b>simple.qos</b><br>${this.$t("BW-limited three-tier prioritisation scheme with your qdisc on each queue. (default)")}</p>`,"simplest.qos":`<p><b>simplest.qos</b><br>${this.$t("Simplest possible configuration: HTB rate limiter with your qdisc attached.")}</p>`,"simplest_tbf.qos":`<p><b>simplest_tbf.qos</b><br>${this.$t("Simplest possible configuration (TBF): TBF rate limiter with your qdisc attached.")}
        ${this.$t("TBF may give better performance than HTB on some architectures.")}</p>`}}},computed:{interfaceOptions(){const i=this.formOptions().interfaceData.filter(t=>{const c=this.formOptions().interfacesConfig.find(a=>a.id===t.id);return t.ifname&&t.ifname!=="lo"&&!t.ifname.startsWith("wwan")&&(!c||c.enabled==="1")}),e=this.formOptions().wirelessData,s=i.map(t=>({name:this.$network.getName(t),ifname:t.ifname})).concat(e.map(t=>({name:t.ssid,ifname:t.ifname}))),r=this.formOptions().deviceData.filter(t=>t.type==="bridge"||!t.virtual||t.name.startsWith("qmimux")).map(t=>t.name);return[...new Set(r)].map(t=>{const c=s.filter(a=>a.ifname===t).map(a=>a.name);return{device:t,ifaces:c}}).filter(({ifaces:t})=>t.length>0).map(({device:t,ifaces:c})=>[t,`${t} (${c.join(", ")})`])},scriptOptions(){return this.section.qdisc==="cake"?this.formOptions().cake:this.section.qdisc==="fq_codel"?this.formOptions().fq_codel:[]},qdiscsOptions(){const i=[];return this.formOptions().fq_codel.length>0&&i.push("fq_codel"),this.formOptions().cake.length>0&&i.push("cake"),i}},methods:{hintOpt(i){return this.scriptOptDescripts[i]}}};var b=function(){var e=this,s=e._self._c;return s("vuci-form",{attrs:{config:"sqm",editing:""},scopedSlots:e._u([{key:"default",fn:function({uciData:r,editableSection:n}){return[s("vuci-named-section",{attrs:{endpoints:[{endpoint:"sqm/config"}],name:n.id,title:e.$t("SQM configuration: %s").format(n.id),"uci-data":r,"data-key":"sqm"},scopedSlots:e._u([{key:"default",fn:function({s:o}){return[s("tlt-tabs",{attrs:{tabs:e.sqmEditTabs},scopedSlots:e._u([{key:"general",fn:function(){return[s("vuci-form-item-switch",{attrs:{"uci-section":o,name:"enabled",label:e.$t("Enabled")}}),s("vuci-form-item-select",{attrs:{"uci-section":o,name:"interface",label:e.$t("Interface name"),options:e.interfaceOptions}}),s("vuci-form-item-input",{attrs:{"uci-section":o,name:"download",label:e.$t("Download speed (kbit/s)"),rules:"irange(0, 2147483647)",help:e.downloadHint,rawhtml:"",required:""}}),s("vuci-form-item-input",{attrs:{"uci-section":o,name:"upload",label:e.$t("Upload speed (kbit/s)"),rules:"irange(0, 2147483647)",help:e.uploadHint,rawhtml:"",required:""}})]},proxy:!0},{key:"advanced",fn:function(){return[s("vuci-form-item-select",{ref:"qdiscSelect",attrs:{"uci-section":o,name:"qdisc",label:e.$t("Queuing disciplines usable on this system"),initial:"cake",options:e.qdiscsOptions}}),s("vuci-form-item-select",{attrs:{"uci-section":o,name:"script",label:e.$t("Queue setup script"),help:e.hintOpt(o.script),initial:"piece_of_cake.qos",rawhtml:"",options:e.scriptOptions}})]},proxy:!0}],null,!0)})]}}],null,!0)})]}}])})},$=[],_=f(u,b,$,!1,null,null,null,null);const q=_.exports,v={provide(){return{formOptions:this.getFormOptions}},data(){return{offloadingData:{},editModal:q,sqmColumns:[{name:"name",label:this.$t("SQM Name")},{name:"interface",label:this.$t("Interface Name")},{name:"download",label:this.$t("Download speed (kbit/s)")},{name:"upload",label:this.$t("Upload speed (kbit/s)")},{name:"enabled",title:this.$t("")}],formOptions:{deviceData:{},wirelessData:[],interfaceData:[],fq_codel:[],cake:[]}}},watch:{offloadingData(i){(i==null?void 0:i.flow_offloading)==="1"&&this.$store.state.board.hwinfo.hw_nat&&this.$alert.info(this.$t('For %s to properly work "Software flow offloading" needs to be turned off on this device. This can be done in %s %s %s %s').format(this.$t("SQM"),"<a class=link href='/network/firewall/zones'>",this.$t("Firewall"),this.$t("General Settings"),"</a>"),!0)}},methods:{handleErrors(i){const e=[];return i.payload.forEach(s=>{e.push(s.errors[0].section)}),e.length===1?this.$t("Saving failed: SQM instance '%s' cannot be enabled due to invalid configuration").format(e[0]):this.$t("Saving failed: SQM instances: '%s' cannot be enabled due to invalid configuration").format(e.join(", "))},getFormOptions(){return this.formOptions},showErr(i){return this.$message.error(this.$t("Failed to load %s data").format(i)),[]},loadData(){return this.$axios.bulkGet([{endpoint:"/api/wireless/interfaces/basic/status",condition:"wireless-regdb.control"},"/api/sqm/options","/api/interfaces/config","/api/interfaces/status","/api/network/devices/status","/api/nat_offloading/global"]).then(([i,e,s,r,n,o])=>{const t=n.success?n.data:this.showErr(this.$t("device")),c=i.success?i.data:this.showErr(this.$t("wireless")),a=e.success?e.data.fq_codel:this.showErr(this.$t("SQM options")),l=e.success?e.data.cake||[]:this.showErr(this.$t("SQM options")),p=s.success?s.data:this.showErr(this.$t("interfaces config")),m=r.success?r.data:this.showErr(this.$t("interfaces status"));return this.offloadingData=o.success?o.data:this.showErr(this.$t("Nat offloading")),this.formOptions={deviceData:t,wirelessData:c,interfacesConfig:p,interfaceData:m,fq_codel:a,cake:l},{}})}}};var g=function(){var e=this,s=e._self._c;return s("vuci-form",{attrs:{config:"sqm","after-load":e.loadData},scopedSlots:e._u([{key:"default",fn:function({uciData:r}){return[s("vuci-typed-section",{attrs:{title:e.$t("Smart Queue Management"),columns:e.sqmColumns,type:"queue","uci-data":r,"edit-form":e.editModal,addremove:"",endpoints:[{endpoint:"sqm/config"}],"data-key":"sqm",help:e.$t("With SQM (Smart Queue Management) you can enable traffic shaping"),"error-handlers":{edit:e.handleErrors}},scopedSlots:e._u([{key:"name",fn:function({s:n}){return[s("vuci-form-item-dummy",{attrs:{"uci-section":n,name:"id",help:e.$t("Name of the SQM configuration. Used for easier management purpose only")}})]}},{key:"interface",fn:function({s:n}){return[s("vuci-form-item-dummy",{attrs:{"uci-section":n,name:"interface"}})]}},{key:"download",fn:function({s:n}){return[s("vuci-form-item-dummy",{attrs:{"uci-section":n,name:"download"}})]}},{key:"upload",fn:function({s:n}){return[s("vuci-form-item-dummy",{attrs:{"uci-section":n,name:"upload"}})]}},{key:"enabled",fn:function({s:n}){return[s("vuci-form-item-switch",{attrs:{"uci-section":n,name:"enabled"}})]}},{key:"addForm",fn:function({addModel:n}){return[s("tlt-form-item-input",{attrs:{label:e.$t("SQM Name"),prop:"id",required:"",help:e.$t("Name of the new sqm"),maxlength:"16",rules:"uciname"},model:{value:n.id,callback:function(o){e.$set(n,"id",o)},expression:"addModel.id"}})]}}],null,!0)})]}}])})},w=[],y=f(v,g,w,!1,null,null,null,null);return y.exports});
