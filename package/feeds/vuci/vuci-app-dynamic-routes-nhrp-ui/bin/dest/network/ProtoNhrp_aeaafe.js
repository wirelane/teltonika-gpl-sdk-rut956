(function(d,u){typeof exports=="object"&&typeof module<"u"?module.exports=u():typeof define=="function"&&define.amd?define(u):(d=typeof globalThis<"u"?globalThis:d||self,d["network/ProtoNhrp_js"]=u())})(this,function(){"use strict";function d(s,e,t,a,i,n,l,f){var r=typeof s=="function"?s.options:s;e&&(r.render=e,r.staticRenderFns=t,r._compiled=!0),a&&(r.functional=!0),n&&(r._scopeId="data-v-"+n);var c;if(l?(c=function(o){o=o||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!o&&typeof __VUE_SSR_CONTEXT__<"u"&&(o=__VUE_SSR_CONTEXT__),i&&i.call(this,o),o&&o._registeredComponents&&o._registeredComponents.add(l)},r._ssrRegister=c):i&&(c=f?function(){i.call(this,(r.functional?this.parent:this).$root.$options.shadowRoot)}:i),c)if(r.functional){r._injectStyles=c;var P=r.render;r.render=function(k,m){return c.call(m),P(k,m)}}else{var p=r.beforeCreate;r.beforeCreate=p?[].concat(p,c):[c]}return{exports:s,options:r}}const u={inject:["formOptions"],props:{section:{type:Object,required:!0}},data(){return{mapping:[{name:"ip_addr",label:this.$t("IP address"),help:this.$t("IP address of a station")},{name:"nbma",label:this.$t("NBMA"),help:this.$t("Non-Broadcast Multi-Access(NBMA) network IP address")},{name:"enabled"}]}},computed:{ifaceOptions(){return this.$network.interfaceOptions(this.formOptions().ifStatus)},ipsecInstance(){return this.formOptions().ipsecInstances.map(s=>s.id)}},methods:{validateIpaddr(s){return this.$VuciValidator.value=s,this.$VuciValidator.ipaddr().isValid||s==="dynamic"?{isValid:!0}:{isValid:!1,message:this.$t("NHS must be an IP address or 'dynamic'")}}}};var h=function(){var e=this,t=e._self._c;return t("vuci-form",{attrs:{config:"nhrp;ipsec",editing:""},scopedSlots:e._u([{key:"default",fn:function({uciData:a,editableSection:i}){return[t("vuci-named-section",{attrs:{"uci-data":a,endpoints:[{endpoint:"nhrp/interface/config"}],"data-key":"interface",name:i.id,title:e.$t("NHRP interface configuration")},scopedSlots:e._u([{key:"default",fn:function({s:n,sd:l}){return[t("vuci-form-item-switch",{attrs:{"uci-section":n,name:"enabled",label:e.$t("Enable"),help:e.$t("Enables client")}}),t("vuci-form-item-select",{attrs:{"uci-section":n,name:"interface",label:e.$t("Interface"),help:e.$t("Interface which will be using NHRP"),options:e.ifaceOptions}}),t("vuci-form-item-input",{attrs:{name:"network_id","uci-section":n,label:e.$t("Network ID"),help:e.$t("Network ID of NHRP"),rules:"irange(1,4294967295)",placeholder:"22"}}),t("vuci-form-item-input",{attrs:{"uci-section":n,name:"auth",label:e.$t("NHRP authentication key"),help:e.$t("NHRP authentication key"),rules:"uciname",placeholder:"12346578",maxlength:"8"}}),t("vuci-form-item-select",{attrs:{"uci-section":n,name:"proto_address",label:e.$t("NHS"),help:e.$t("IP address of Next-Hop Server"),options:[["dynamic",e.$t("dynamic")]],rules:e.validateIpaddr,"allow-create":""}}),t("vuci-form-item-input",{attrs:{"uci-section":n,name:"nbma_address",label:e.$t("NBMA"),help:e.$t("Non-Broadcast Multi-Access(NBMA) network IP address"),rules:"host",placeholder:"0.0.0.0"}}),t("vuci-form-item-input",{attrs:{"uci-section":n,name:"holdtime",label:e.$t("Hold-time"),help:e.$t("Specifies the holding time for NHRP Registration Requests and Resolution Replies sent from this interface or shortcut-target. The holdtime is specified in seconds and defaults to two hours."),rules:"irange(1,65000)",initial:"7200"}}),t("vuci-form-item-switch",{attrs:{"uci-section":n,name:"ipsec_support",label:e.$t("IPsec support"),help:e.$t("Use NHRP over IPsec")}}),t("vuci-form-item-select",{attrs:{"uci-section":n,name:"ipsec_instance",label:e.$t("IPsec instance"),help:e.$t("Select IPsec instance name"),options:e.ipsecInstance,depend:l.ipsec_support==="1",placeholder:e.$t("-- Please select --")}})]}}],null,!0)}),t("vuci-typed-section",{attrs:{"uci-data":a,endpoints:[{endpoint:`nhrp/interface/${e.section.id}/mapping/config/`}],"data-key":"mapping",type:`${e.section.id}_map`,title:e.$t("NHRP mappings configuration"),columns:e.mapping,addremove:""},scopedSlots:e._u([{key:"ip_addr",fn:function({s:n}){return[t("vuci-form-item-input",{attrs:{"uci-section":n,name:"ip_addr",rules:"host",placeholder:"0.0.0.0"}})]}},{key:"nbma",fn:function({s:n}){return[t("vuci-form-item-input",{attrs:{"uci-section":n,name:"nbma",rules:"host",placeholder:"0.0.0.0"}})]}},{key:"enabled",fn:function({s:n}){return[t("vuci-form-item-switch",{attrs:{"uci-section":n,name:"enabled"}})]}}],null,!0)})]}}])})},$=[],_=d(u,h,$,!1,null,null,null,null);const v=_.exports,b={provide(){return{formOptions:this.getFormOptions}},data(){return{protoNhrpInterfaceEdit:v,interfaces:[{name:"id",label:this.$t("Name"),help:this.$t("List of created interfaces")},{name:"interface",label:this.$t("Interface"),help:this.$t("Interface which will be using NHRP")},{name:"proto_address",label:this.$t("NHS"),help:this.$t("IP address of Next-Hop Server.")},{name:"nbma_address",label:this.$t("NBMA"),help:this.$t("IP address of Next-Hop Server")},{name:"enabled",label:this.$t("Enabled")}],ifaceInstance:[],ifStatus:[],ipsecConfig:[]}},methods:{getInterface(s){return this.$network.interfaceOptions(this.ifStatus).find(a=>a[0]===s)[1]},getFormOptions(){return{ipsecInstances:this.ipsecConfig,ifStatus:this.ifStatus}},isChildOfDMVPN(s){var e;return(e=s.service)==null?void 0:e.includes("dmvpn")},deleteHints(s){return this.isChildOfDMVPN(s)?[{info:this.$t("This instance can't be deleted because it is part of DMVPN configuration")}]:[]},afterLoad(s){return new Promise(e=>{const t=s.interface.map(a=>`/api/nhrp/interface/${a.id}/mapping/config`);this.$axios.bulkGet(["/api/interfaces/status","/api/ipsec/config",...t]).then(([a,i,...n])=>{a.success?this.ifStatus=a.data:this.$message.error(this.$t("Failed to load interface status")),i.success?this.ipsecConfig=i.data:this.$message.error(this.$t("Failed to load ipsec configuration")),n.some(f=>!f.success)&&this.$message.error(this.$t("Failed to load nhrp configuration"));const l=n.reduce((f,r)=>f.concat(r.data),[]);e({mapping:l})}).catch(()=>{this.$message.error(this.$t("Unexpected error occurred"))})})}}};var g=function(){var e=this,t=e._self._c;return t("vuci-form",{attrs:{config:"nhrp","after-load":e.afterLoad},scopedSlots:e._u([{key:"default",fn:function({uciData:a}){return[t("vuci-named-section",{attrs:{"uci-data":a,name:"general",endpoints:[{endpoint:"nhrp/global"}],"data-key":"nhrp",title:e.$t("NHRP - Global Settings")},scopedSlots:e._u([{key:"default",fn:function({s:i}){return[t("vuci-form-item-switch",{attrs:{"uci-section":i,name:"enabled",label:e.$t("Enable service"),help:e.$t("Enable service")}}),t("vuci-form-item-switch",{attrs:{"uci-section":i,name:"debug",label:e.$t("Enable logging"),help:e.$t("Enable logging of NHRP")}})]}}],null,!0)}),t("vuci-typed-section",{attrs:{"uci-data":a,type:"nhrp_instance",endpoints:[{endpoint:"nhrp/interface/config"}],"data-key":"interface",title:e.$t("Interfaces"),help:e.$t("List of created interfaces"),columns:e.interfaces,"edit-form":e.protoNhrpInterfaceEdit},scopedSlots:e._u([{key:"id",fn:function({s:i}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":i,name:"id"}})]}},{key:"interface",fn:function({s:i}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":i,name:"interface",placeholder:e.$t("Not defined"),"display-value":e.getInterface}})]}},{key:"proto_address",fn:function({s:i}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":i,name:"proto_address",placeholder:e.$t("Not defined")}})]}},{key:"nbma_address",fn:function({s:i}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":i,name:"nbma_address",placeholder:e.$t("Not defined")}})]}},{key:"enabled",fn:function({s:i}){return[t("vuci-form-item-switch",{attrs:{"uci-section":i,name:"enabled"}})]}},{key:"deleteBtn",fn:function({s:i,actions:n}){return[t("tlt-hint",{class:{"read-only-button-padding":e.isChildOfDMVPN(i)},attrs:{hints:e.deleteHints(i),"align-right":""}},[t("tlt-button",{attrs:{readonly:e.isChildOfDMVPN(i),color:"error",type:"text",size:"md"},on:{click:function(l){return n.delete(i.id)}}},[e._v(e._s(e.$t("Delete")))])],1)]}},{key:"addForm",fn:function({addModel:i}){return[t("tlt-form-item-input",{attrs:{label:e.$t("Name"),prop:"id",rules:"uciname",maxlength:"8",required:""},model:{value:i.id,callback:function(n){e.$set(i,"id",n)},expression:"addModel.id"}})]}}],null,!0)})]}}])})},N=[],y=d(b,g,N,!1,null,"f47a3189",null,null);return y.exports});
